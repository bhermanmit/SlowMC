<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>SlowMC: /mnt/md0/Documents/Documents/Spring2012/211/SlowMC/src/xml-fortran/xmlreader.f90 Source File</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="doxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<!-- Generated by Doxygen 1.7.3 -->
<div id="top">
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td style="padding-left: 0.5em;">
   <div id="projectname">SlowMC</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="namespaces.html"><span>Modules</span></a></li>
      <li><a href="annotated.html"><span>Data&#160;Types&#160;List</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
      <li><a href="dirs.html"><span>Directories</span></a></li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="files.html"><span>File&#160;List</span></a></li>
      <li><a href="globals.html"><span>File&#160;Members</span></a></li>
    </ul>
  </div>
  <div id="nav-path" class="navpath">
    <ul>
      <li class="navelem"><a class="el" href="dir_0ea2310d7b8e057f22c83ef6e149b138.html">src</a>      </li>
      <li class="navelem"><a class="el" href="dir_30216995ac94fa0675f2861a3076ad69.html">xml-fortran</a>      </li>
    </ul>
  </div>
</div>
<div class="header">
  <div class="headertitle">
<h1>xmlreader.f90</h1>  </div>
</div>
<div class="contents">
<a href="xmlreader_8f90.html">Go to the documentation of this file.</a><div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 <span class="comment">!===============================================================================</span>
<a name="l00002"></a>00002 <span class="comment">! XMLREADER:</span>
<a name="l00003"></a>00003 <span class="comment">!    Read an XML-file that contains a template for the data and the XML files</span>
<a name="l00004"></a>00004 <span class="comment">!    that will be used in a program and generate a module with reading routines.</span>
<a name="l00005"></a>00005 <span class="comment">!</span>
<a name="l00006"></a>00006 <span class="comment">! TODO:</span>
<a name="l00007"></a>00007 <span class="comment">! - Private routines!</span>
<a name="l00008"></a>00008 <span class="comment">! - Error for unknown data types</span>
<a name="l00009"></a>00009 <span class="comment">! - Length for character items</span>
<a name="l00010"></a>00010 <span class="comment">!===============================================================================</span>
<a name="l00011"></a>00011 
<a name="l00012"></a><a class="code" href="xmlreader_8f90.html#aa8adf2839b9a8b0e565b860756fa6d35">00012</a> <span class="keyword">program</span> <a class="code" href="xmlreader_8f90.html#aa8adf2839b9a8b0e565b860756fa6d35">xmlreader</a>
<a name="l00013"></a>00013    use <span class="keywordflow">XMLPARSE</span>
<a name="l00014"></a>00014    <span class="keyword">implicit none</span>
<a name="l00015"></a>00015 
<a name="l00016"></a>00016    <span class="keywordtype">character(len=60)</span>                      :: fname
<a name="l00017"></a>00017    <span class="keywordtype">type(XML_PARSE)</span>                        :: info
<a name="l00018"></a>00018 
<a name="l00019"></a>00019    <span class="keywordtype">character(len=80)</span>                      :: tag
<a name="l00020"></a>00020    <span class="keywordtype">character(len=80)</span>                      :: starttag
<a name="l00021"></a>00021    <span class="keywordtype">logical</span>                                :: endtag
<a name="l00022"></a>00022    <span class="keywordtype">character(len=80)</span>, <span class="keywordtype">dimension(1:2,1:20)</span> :: attribs
<a name="l00023"></a>00023    <span class="keywordtype">integer</span>                                :: noattribs
<a name="l00024"></a>00024    <span class="keywordtype">character(len=100000)</span>, <span class="keywordtype">dimension(1:1000)</span>  :: data
<a name="l00025"></a>00025    <span class="keywordtype">integer</span>                                :: nodata
<a name="l00026"></a>00026    <span class="keywordtype">integer</span>                                :: i
<a name="l00027"></a>00027    <span class="keywordtype">integer</span>                                :: j
<a name="l00028"></a>00028    <span class="keywordtype">integer</span>, <span class="keywordtype">parameter</span>                     :: notmps = 6 <span class="comment">! Number of temporary files needed!</span>
<a name="l00029"></a>00029    <span class="keywordtype">integer</span>                                :: ludef
<a name="l00030"></a>00030    <span class="keywordtype">integer</span>                                :: ludeflt
<a name="l00031"></a>00031    <span class="keywordtype">integer</span>                                :: luinit
<a name="l00032"></a>00032    <span class="keywordtype">integer</span>                                :: lusubs
<a name="l00033"></a>00033    <span class="keywordtype">integer</span>                                :: luprolog
<a name="l00034"></a>00034    <span class="keywordtype">integer</span>                                :: lustart
<a name="l00035"></a>00035    <span class="keywordtype">integer</span>                                :: luloop
<a name="l00036"></a>00036    <span class="keywordtype">integer</span>                                :: luend
<a name="l00037"></a>00037    <span class="keywordtype">integer</span>                                :: lumain
<a name="l00038"></a>00038    <span class="keywordtype">integer</span>                                :: luwrite
<a name="l00039"></a>00039    <span class="keywordtype">integer</span>                                :: luwritp
<a name="l00040"></a>00040    <span class="keywordtype">integer</span>                                :: luwrv
<a name="l00041"></a>00041    <span class="keywordtype">integer</span>                                :: argc
<a name="l00042"></a>00042    <span class="keywordtype">logical</span>                                :: prolog_written
<a name="l00043"></a>00043    <span class="keywordtype">logical</span>                                :: comp
<a name="l00044"></a>00044    <span class="keywordtype">logical</span>                                :: error
<a name="l00045"></a>00045    <span class="keywordtype">logical</span>                                :: begin_loop = .true.
<a name="l00046"></a>00046    <span class="keywordtype">logical</span>                                :: begin_main_loop = .true.
<a name="l00047"></a>00047    <span class="keywordtype">logical</span>                                :: begin_component = .false.
<a name="l00048"></a>00048    <span class="keywordtype">logical</span>                                :: strict
<a name="l00049"></a>00049    <span class="keywordtype">logical</span>                                :: global_type
<a name="l00050"></a>00050    <span class="keywordtype">logical</span>                                :: dyn_strings
<a name="l00051"></a>00051 
<a name="l00052"></a>00052    <span class="keywordtype">character(len=32)</span>                      :: root_name
<a name="l00053"></a>00053    <span class="keywordtype">character(len=32)</span>                      :: global_name
<a name="l00054"></a>00054    <span class="keywordtype">character(len=32)</span>                      :: typename
<a name="l00055"></a>00055    <span class="keywordtype">character(len=32)</span>, <span class="keywordtype">dimension(1:20)</span>     :: placeholder
<a name="l00056"></a>00056    <span class="keywordtype">integer</span>                                :: no_placeholders
<a name="l00057"></a>00057 
<a name="l00058"></a>00058    <span class="keywordtype">character(len=50)</span>                      :: declare
<a name="l00059"></a>00059    <span class="keywordtype">character(len=50)</span>, <span class="keywordtype">dimension(:,:)</span>, <span class="keywordtype">pointer</span> :: types
<a name="l00060"></a>00060    <span class="keywordtype">character(len=50)</span>, <span class="keywordtype">dimension(:,:)</span>, <span class="keywordtype">pointer</span> :: new_types
<a name="l00061"></a>00061    
<a name="l00062"></a>00062    <span class="comment">! TODO: arrays of integers etc, in addition to integer-arrays - see: word</span>
<a name="l00063"></a>00063    <span class="keywordtype">integer</span>, <span class="keywordtype">parameter</span>                     :: notypes_predefined = 27
<a name="l00064"></a>00064    <span class="keywordtype">character(len=50)</span>, <span class="keywordtype">dimension(1:4,1:notypes_predefined)</span> :: predefined_types
<a name="l00065"></a>00065    <span class="keywordtype">integer</span>                                :: notypes = notypes_predefined
<a name="l00066"></a>00066    <span class="keyword">data</span> ((predefined_types(i,j) , i=1,4), j=1,notypes_predefined ) / &amp;
<a name="l00067"></a>00067 <span class="stringliteral">&#39;logical&#39;</span>       ,<span class="stringliteral">&#39;   logical&#39;</span>                        , <span class="stringliteral">&#39;read_xml_logical&#39;</span>,       <span class="stringliteral">&#39;write_to_xml_logical&#39;</span>, &amp;
<a name="l00068"></a>00068 <span class="stringliteral">&#39;logical-1dim&#39;</span>  ,<span class="stringliteral">&#39;   logical, dimension(:), pointer&#39;</span> , <span class="stringliteral">&#39;read_xml_logical_1dim&#39;</span>,  <span class="stringliteral">&#39;write_to_xml_logical_1dim&#39;</span>,  &amp;
<a name="l00069"></a>00069 <span class="stringliteral">&#39;logical-array&#39;</span> ,<span class="stringliteral">&#39;   logical, dimension(:), pointer&#39;</span> , <span class="stringliteral">&#39;read_xml_logical_array&#39;</span>, <span class="stringliteral">&#39;write_to_xml_logical_array&#39;</span>, &amp;
<a name="l00070"></a>00070 <span class="stringliteral">&#39;logical-shape&#39;</span> ,<span class="stringliteral">&#39;   logical, dimension(SHAPE)&#39;</span>      , <span class="stringliteral">&#39;read_xml_logical_array&#39;</span>, <span class="stringliteral">&#39;write_to_xml_logical_array&#39;</span>, &amp;
<a name="l00071"></a>00071 <span class="stringliteral">&#39;integer&#39;</span>       ,<span class="stringliteral">&#39;   integer&#39;</span>                        , <span class="stringliteral">&#39;read_xml_integer&#39;</span>,       <span class="stringliteral">&#39;write_to_xml_integer&#39;</span>, &amp;
<a name="l00072"></a>00072 <span class="stringliteral">&#39;integer-1dim&#39;</span>  ,<span class="stringliteral">&#39;   integer, dimension(:), pointer&#39;</span> , <span class="stringliteral">&#39;read_xml_integer_1dim&#39;</span>,  <span class="stringliteral">&#39;write_to_xml_integer_1dim&#39;</span>,  &amp;
<a name="l00073"></a>00073 <span class="stringliteral">&#39;integer-array&#39;</span> ,<span class="stringliteral">&#39;   integer, dimension(:), pointer&#39;</span> , <span class="stringliteral">&#39;read_xml_integer_array&#39;</span>, <span class="stringliteral">&#39;write_to_xml_integer_array&#39;</span>, &amp;
<a name="l00074"></a>00074 <span class="stringliteral">&#39;integer-shape&#39;</span> ,<span class="stringliteral">&#39;   integer, dimension(SHAPE)&#39;</span>      , <span class="stringliteral">&#39;read_xml_integer_array&#39;</span>, <span class="stringliteral">&#39;write_to_xml_integer_array&#39;</span>, &amp;
<a name="l00075"></a>00075 <span class="stringliteral">&#39;real&#39;</span>          ,<span class="stringliteral">&#39;   real&#39;</span>                           , <span class="stringliteral">&#39;read_xml_real&#39;</span>   ,       <span class="stringliteral">&#39;write_to_xml_real&#39;</span>   , &amp;
<a name="l00076"></a>00076 <span class="stringliteral">&#39;real-1dim&#39;</span>     ,<span class="stringliteral">&#39;   real, dimension(:), pointer&#39;</span>    , <span class="stringliteral">&#39;read_xml_real_1dim&#39;</span>,     <span class="stringliteral">&#39;write_to_xml_real_1dim&#39;</span>, &amp;
<a name="l00077"></a>00077 <span class="stringliteral">&#39;real-array&#39;</span>    ,<span class="stringliteral">&#39;   real, dimension(:), pointer&#39;</span>    , <span class="stringliteral">&#39;read_xml_real_array&#39;</span>,    <span class="stringliteral">&#39;write_to_xml_real_array&#39;</span>, &amp;
<a name="l00078"></a>00078 <span class="stringliteral">&#39;real-shape&#39;</span>    ,<span class="stringliteral">&#39;   real, dimension(SHAPE)&#39;</span>         , <span class="stringliteral">&#39;read_xml_real_array&#39;</span>,    <span class="stringliteral">&#39;write_to_xml_real_array&#39;</span>, &amp;
<a name="l00079"></a>00079 <span class="stringliteral">&#39;double&#39;</span>        ,<span class="stringliteral">&#39;   real(kind=kind(1.0d0))&#39;</span>         , <span class="stringliteral">&#39;read_xml_double&#39;</span>,        <span class="stringliteral">&#39;write_to_xml_double&#39;</span>,  &amp;
<a name="l00080"></a>00080 <span class="stringliteral">&#39;double-1dim&#39;</span>   ,<span class="stringliteral">&#39;   real(kind=kind(1.0d0)), dimension(:), pointer&#39;</span> , &amp;
<a name="l00081"></a>00081                                                        <span class="stringliteral">&#39;read_xml_double_1dim&#39;</span>,   <span class="stringliteral">&#39;write_to_xml_double_1dim&#39;</span>, &amp;
<a name="l00082"></a>00082 <span class="stringliteral">&#39;double-array&#39;</span>  ,<span class="stringliteral">&#39;   real(kind=kind(1.0d0)), dimension(:), pointer&#39;</span> , &amp;
<a name="l00083"></a>00083                                                        <span class="stringliteral">&#39;read_xml_double_array&#39;</span>,  <span class="stringliteral">&#39;write_to_xml_double_array&#39;</span>, &amp;
<a name="l00084"></a>00084 <span class="stringliteral">&#39;double-shape&#39;</span>  ,<span class="stringliteral">&#39;   real(kind=kind(1.0d0)), dimension(SHAPE)&#39;</span>      , &amp;
<a name="l00085"></a>00085                                                        <span class="stringliteral">&#39;read_xml_double_array&#39;</span>,  <span class="stringliteral">&#39;write_to_xml_double_array&#39;</span>, &amp;
<a name="l00086"></a>00086 <span class="stringliteral">&#39;word&#39;</span>          ,<span class="stringliteral">&#39;   character(len=?)&#39;</span>               , <span class="stringliteral">&#39;read_xml_word&#39;</span>,          <span class="stringliteral">&#39;write_to_xml_word&#39;</span>,    &amp;
<a name="l00087"></a>00087 <span class="stringliteral">&#39;word-1dim&#39;</span>     ,<span class="stringliteral">&#39;   character(len=?), dimension(:), pointer&#39;</span> , <span class="stringliteral">&#39;read_xml_word_1dim&#39;</span>,  <span class="stringliteral">&#39;write_to_xml_word_1dim&#39;</span>,  &amp;
<a name="l00088"></a>00088 <span class="stringliteral">&#39;word-array&#39;</span>    ,<span class="stringliteral">&#39;   character(len=?), dimension(:), pointer&#39;</span> , <span class="stringliteral">&#39;read_xml_word_array&#39;</span>, <span class="stringliteral">&#39;write_to_xml_word_array&#39;</span>, &amp;
<a name="l00089"></a>00089 <span class="stringliteral">&#39;word-shape&#39;</span>    ,<span class="stringliteral">&#39;   character(len=?), dimension(SHAPE)&#39;</span>      , <span class="stringliteral">&#39;read_xml_word_array&#39;</span>, <span class="stringliteral">&#39;write_to_xml_word_array&#39;</span>, &amp;
<a name="l00090"></a>00090 <span class="stringliteral">&#39;line&#39;</span>          ,<span class="stringliteral">&#39;   character(len=?)&#39;</span>               , <span class="stringliteral">&#39;read_xml_line&#39;</span>,          <span class="stringliteral">&#39;write_to_xml_line&#39;</span>,    &amp;
<a name="l00091"></a>00091 <span class="stringliteral">&#39;line-1dim&#39;</span>     ,<span class="stringliteral">&#39;   character(len=?), dimension(:), pointer&#39;</span>  , <span class="stringliteral">&#39;read_xml_line_1dim&#39;</span>,  <span class="stringliteral">&#39;write_to_xml_line_1dim&#39;</span>,  &amp;
<a name="l00092"></a>00092 <span class="stringliteral">&#39;line-array&#39;</span>    ,<span class="stringliteral">&#39;   character(len=?), dimension(:), pointer&#39;</span>  , <span class="stringliteral">&#39;read_xml_line_array&#39;</span>, <span class="stringliteral">&#39;write_to_xml_line_array&#39;</span>, &amp;
<a name="l00093"></a>00093 <span class="stringliteral">&#39;line-shape&#39;</span>    ,<span class="stringliteral">&#39;   character(len=?), dimension(SHAPE)&#39;</span>       , <span class="stringliteral">&#39;read_xml_line_array&#39;</span>, <span class="stringliteral">&#39;write_to_xml_line_array&#39;</span>, &amp;
<a name="l00094"></a>00094 <span class="stringliteral">&#39;character&#39;</span>     ,<span class="stringliteral">&#39;   character(len=?)&#39;</span>               , <span class="stringliteral">&#39;read_xml_line&#39;</span>,                 <span class="stringliteral">&#39;write_to_xml_line&#39;</span>,    &amp;
<a name="l00095"></a>00095 <span class="stringliteral">&#39;character-array&#39;</span>,<span class="stringliteral">&#39;   character(len=?), dimension(:), pointer&#39;</span> , <span class="stringliteral">&#39;read_xml_line_array&#39;</span>, <span class="stringliteral">&#39;write_to_xml_line_array&#39;</span>, &amp;
<a name="l00096"></a>00096 <span class="stringliteral">&#39;character-shape&#39;</span>,<span class="stringliteral">&#39;   character(len=?), dimension(SHAPE)&#39;</span>      , <span class="stringliteral">&#39;read_xml_line_array&#39;</span>, <span class="stringliteral">&#39;write_to_xml_line_array&#39;</span> /
<a name="l00097"></a>00097 
<a name="l00098"></a>00098    <span class="keyword">allocate</span>( types(1:4,1:notypes) )
<a name="l00099"></a>00099    types = predefined_types(:,1:notypes)
<a name="l00100"></a>00100 
<a name="l00101"></a>00101    <span class="comment">!</span>
<a name="l00102"></a>00102    <span class="comment">! Read the global options file, if present</span>
<a name="l00103"></a>00103    <span class="comment">!</span>
<a name="l00104"></a>00104    strict      = .false.
<a name="l00105"></a>00105    global_type = .false.
<a name="l00106"></a>00106    dyn_strings = .true.
<a name="l00107"></a>00107    call <a class="code" href="xmlreader_8f90.html#a749f0ad768591d470d09730ee7d44db3">get_global_options</a>( attribs, noattribs, strict, global_type, global_name, &amp;
<a name="l00108"></a>00108                             root_name, dyn_strings )
<a name="l00109"></a>00109 
<a name="l00110"></a>00110    <span class="comment">!</span>
<a name="l00111"></a>00111    <span class="comment">! Open the input file and read the name of the template.</span>
<a name="l00112"></a>00112    <span class="comment">! Load the template into a tree and then generate it all</span>
<a name="l00113"></a>00113    <span class="comment">! in stages</span>
<a name="l00114"></a>00114    <span class="comment">!</span>
<a name="l00115"></a>00115    argc = COMMAND_ARGUMENT_COUNT()
<a name="l00116"></a>00116    <span class="keyword">if</span> (argc &gt; 0) <span class="keyword">then</span>
<a name="l00117"></a>00117       call GET_COMMAND_ARGUMENT(1, fname)
<a name="l00118"></a>00118    <span class="keyword">else</span>
<a name="l00119"></a>00119       <span class="keyword">open</span>(UNIT=10, FILE=<span class="stringliteral">&#39;xmlreader.inp&#39;</span>)
<a name="l00120"></a>00120       <span class="keyword">read</span>(UNIT=10, FMT=<span class="stringliteral">&#39;(a)&#39;</span>) fname
<a name="l00121"></a>00121       <span class="keyword">close</span>(UNIT=10)
<a name="l00122"></a>00122    <span class="keyword">end if</span>
<a name="l00123"></a>00123 
<a name="l00124"></a>00124    <span class="keyword">open</span>( 20, file = <span class="stringliteral">&#39;xmlreader.out&#39;</span> )
<a name="l00125"></a>00125    call <a class="code" href="namespacexmlparse.html#a2d3794efad3eeed77896df25f0f91bca">xml_options</a>( info, report_lun = 20, report_details = .true. )
<a name="l00126"></a>00126 
<a name="l00127"></a>00127    prolog_written = .false.
<a name="l00128"></a>00128    <span class="comment">!</span>
<a name="l00129"></a>00129    <span class="comment">! Set the defaults</span>
<a name="l00130"></a>00130    <span class="comment">!</span>
<a name="l00131"></a>00131    global_type = .false.
<a name="l00132"></a>00132    global_name = fname
<a name="l00133"></a>00133    root_name   = fname
<a name="l00134"></a>00134 
<a name="l00135"></a>00135    ludef    = 21
<a name="l00136"></a>00136    lusubs   = 22
<a name="l00137"></a>00137    luinit   = 23
<a name="l00138"></a>00138    luwritp  = 24
<a name="l00139"></a>00139    luwrv    = luwritp
<a name="l00140"></a>00140    <span class="keyword">open</span>( ludef,   file = trim(fname)//<span class="stringliteral">&#39;.f90&#39;</span> )
<a name="l00141"></a>00141    <span class="keyword">open</span>( lusubs,  status = <span class="stringliteral">&#39;scratch&#39;</span> )
<a name="l00142"></a>00142    <span class="keyword">open</span>( luinit,  status = <span class="stringliteral">&#39;scratch&#39;</span> )
<a name="l00143"></a>00143    <span class="keyword">open</span>( luwritp, status = <span class="stringliteral">&#39;scratch&#39;</span> )
<a name="l00144"></a>00144    call <a class="code" href="xmlreader_8f90.html#a0d4c0b96aed4f686ec75542ed9c8c01e">open_tmp_files</a>( 31 )
<a name="l00145"></a>00145 
<a name="l00146"></a>00146    lumain   = luloop
<a name="l00147"></a>00147 
<a name="l00148"></a>00148    <span class="comment">! Read the template file and act as we go along:</span>
<a name="l00149"></a>00149    <span class="comment">! - write the declarations</span>
<a name="l00150"></a>00150    <span class="comment">! - write the main reading routine</span>
<a name="l00151"></a>00151    <span class="comment">! - write the individual reading routines</span>
<a name="l00152"></a>00152    <span class="comment">! - the root element is needed because of the definition of XML files,</span>
<a name="l00153"></a>00153    <span class="comment">!   but we ignore it.</span>
<a name="l00154"></a>00154    <span class="comment">!</span>
<a name="l00155"></a>00155    call <a class="code" href="namespacexmlparse.html#ae06195e892d5b0715d0654adec1b9b10">xml_open</a>( info, trim(fname)//<span class="stringliteral">&#39;.xml&#39;</span>, .true. )
<a name="l00156"></a>00156 
<a name="l00157"></a>00157    error = .false.
<a name="l00158"></a>00158    comp  = .false.
<a name="l00159"></a>00159    no_placeholders = 0
<a name="l00160"></a>00160 
<a name="l00161"></a>00161    call <a class="code" href="namespacexmlparse.html#a282354b1e411ce4bad44768c57138777">xml_get</a>( info, starttag, endtag, attribs, noattribs, <span class="keyword">data</span>, nodata )
<a name="l00162"></a>00162 
<a name="l00163"></a>00163    <span class="keyword">do</span>
<a name="l00164"></a>00164       call <a class="code" href="namespacexmlparse.html#a282354b1e411ce4bad44768c57138777">xml_get</a>( info, tag, endtag, attribs, noattribs, <span class="keyword">data</span>, nodata )
<a name="l00165"></a>00165       <span class="keyword">write</span>(20,*) <span class="stringliteral">&#39;tag: &#39;</span>,tag
<a name="l00166"></a>00166       <span class="keyword">write</span>(20,*) <span class="stringliteral">&#39;attribs: &#39;</span>,noattribs
<a name="l00167"></a>00167       <span class="keyword">if</span> ( noattribs &gt; 0 ) <span class="keyword">then</span>
<a name="l00168"></a>00168          <span class="keyword">write</span>(20,<span class="stringliteral">&#39;(4a)&#39;</span>) ( <span class="stringliteral">&#39;   &#39;</span>, trim(attribs(1,i)), <span class="stringliteral">&#39; = &#39;</span>, trim(attribs(2,i)), i=1,noattribs )
<a name="l00169"></a>00169       <span class="keyword">endif</span>
<a name="l00170"></a>00170       <span class="keyword">write</span>(20,*) <span class="stringliteral">&#39;data: &#39;</span>,nodata
<a name="l00171"></a>00171       <span class="keyword">if</span> ( nodata &gt; 0 ) <span class="keyword">then</span>
<a name="l00172"></a>00172          <span class="keyword">write</span>(20,<span class="stringliteral">&#39;(3a)&#39;</span>) ( <span class="stringliteral">&#39;   &gt;&#39;</span>, trim(<span class="keyword">data</span>(i)), <span class="stringliteral">&#39;&lt;&#39;</span>, i=1,nodata )
<a name="l00173"></a>00173       <span class="keyword">endif</span>
<a name="l00174"></a>00174       <span class="keyword">if</span> ( <a class="code" href="namespacexmlparse.html#a47a7f67bb20b74010c1e1c36b84fec73">xml_error</a>(info) ) <span class="keyword">then</span>
<a name="l00175"></a>00175          <span class="keyword">write</span>(*,*) <span class="stringliteral">&#39;Error reading template file!&#39;</span>
<a name="l00176"></a>00176          <span class="comment">!stop</span>
<a name="l00177"></a>00177          exit
<a name="l00178"></a>00178       <span class="keyword">endif</span>
<a name="l00179"></a>00179 
<a name="l00180"></a>00180       <span class="comment">!</span>
<a name="l00181"></a>00181       <span class="comment">! When encountering the endtag, then close the</span>
<a name="l00182"></a>00182       <span class="comment">! current definition</span>
<a name="l00183"></a>00183       <span class="comment">!</span>
<a name="l00184"></a>00184       <span class="keyword">if</span> ( endtag .and. noattribs == 0 ) <span class="keyword">then</span>
<a name="l00185"></a>00185          <span class="keyword">select</span> <span class="keyword">case</span> ( tag )
<a name="l00186"></a>00186          <span class="keyword">case</span> ( <span class="stringliteral">&#39;typedef&#39;</span> )
<a name="l00187"></a>00187             call <a class="code" href="xmlreader_8f90.html#aabb75ff9c02902a838fdd97cd8ac2e63">close_typedef</a>( begin_component )
<a name="l00188"></a>00188          <span class="keyword">case</span> ( <span class="stringliteral">&#39;placeholder&#39;</span> )
<a name="l00189"></a>00189            <span class="comment">!if ( comp ) then</span>
<a name="l00190"></a>00190            <span class="comment">!   call close_placeholder</span>
<a name="l00191"></a>00191            <span class="comment">!endif</span>
<a name="l00192"></a>00192            <span class="comment">!comp = .false.</span>
<a name="l00193"></a>00193             call <a class="code" href="xmlreader_8f90.html#a281485a4b84d9661d3b0c26446d0b277">close_placeholder</a>
<a name="l00194"></a>00194             luwrv = luwritp
<a name="l00195"></a>00195          <span class="keyword">case</span> default
<a name="l00196"></a>00196             <span class="comment">!</span>
<a name="l00197"></a>00197             <span class="comment">! Have we found the end of the definition?</span>
<a name="l00198"></a>00198             <span class="comment">!</span>
<a name="l00199"></a>00199             <span class="keyword">if</span> ( tag == starttag ) <span class="keyword">then</span>
<a name="l00200"></a>00200                exit
<a name="l00201"></a>00201             <span class="keyword">endif</span>
<a name="l00202"></a>00202          <span class="keyword">end select</span>
<a name="l00203"></a>00203 
<a name="l00204"></a>00204          <span class="keyword">if</span> ( <a class="code" href="namespacexmlparse.html#a2a906a54d0b5956b8aa809c90aa82c38">xml_ok</a>(info) ) <span class="keyword">then</span>
<a name="l00205"></a>00205             cycle
<a name="l00206"></a>00206          <span class="keyword">else</span>
<a name="l00207"></a>00207             exit
<a name="l00208"></a>00208          <span class="keyword">endif</span>
<a name="l00209"></a>00209 
<a name="l00210"></a>00210       <span class="keyword">endif</span>
<a name="l00211"></a>00211 
<a name="l00212"></a>00212       <span class="comment">!</span>
<a name="l00213"></a>00213       <span class="comment">! Opening tags: dispatch on the actual tag</span>
<a name="l00214"></a>00214       <span class="comment">!</span>
<a name="l00215"></a>00215       <span class="keyword">select</span> <span class="keyword">case</span>( tag )
<a name="l00216"></a>00216       <span class="keyword">case</span>( <span class="stringliteral">&#39;options&#39;</span> )
<a name="l00217"></a>00217          call <a class="code" href="xmlreader_8f90.html#a11d0d26158fd59056145256cb88b73f2">set_options</a>( attribs, noattribs, strict, global_type, &amp;
<a name="l00218"></a>00218                            global_name, root_name, dyn_strings )
<a name="l00219"></a>00219          <span class="keyword">if</span> ( .not. prolog_written ) <span class="keyword">then</span>
<a name="l00220"></a>00220              prolog_written = .true.
<a name="l00221"></a>00221              call <a class="code" href="xmlreader_8f90.html#adc42635b06990dc0b52ab774961136d6">write_prolog</a>
<a name="l00222"></a>00222          <span class="keyword">else</span>
<a name="l00223"></a>00223              <span class="keyword">write</span>(20,*) <span class="stringliteral">&#39;Options element should be the first child of the root element&#39;</span>,&amp;
<a name="l00224"></a>00224                          <span class="stringliteral">&#39;Otherwise it has no effect!&#39;</span>
<a name="l00225"></a>00225          <span class="keyword">endif</span>
<a name="l00226"></a>00226 
<a name="l00227"></a>00227          <span class="keyword">if</span> ( strict ) <span class="keyword">then</span>
<a name="l00228"></a>00228             <span class="keyword">write</span>( lumain, <span class="stringliteral">&#39;(a)&#39;</span> ) <span class="stringliteral">&#39;   strict_ = .true.&#39;</span>
<a name="l00229"></a>00229          <span class="keyword">else</span>
<a name="l00230"></a>00230             <span class="keyword">write</span>( lumain, <span class="stringliteral">&#39;(a)&#39;</span> ) <span class="stringliteral">&#39;   strict_ = .false.&#39;</span>
<a name="l00231"></a>00231          <span class="keyword">endif</span>
<a name="l00232"></a>00232 
<a name="l00233"></a>00233       <span class="keyword">case</span>( <span class="stringliteral">&#39;comment&#39;</span>, <span class="stringliteral">&#39;!--&#39;</span> )
<a name="l00234"></a>00234          <span class="comment">! Do nothing</span>
<a name="l00235"></a>00235 
<a name="l00236"></a>00236       <span class="keyword">case</span>( <span class="stringliteral">&#39;placeholder&#39;</span> )
<a name="l00237"></a>00237          <span class="keyword">if</span> ( .not. prolog_written ) <span class="keyword">then</span>
<a name="l00238"></a>00238              prolog_written = .true.
<a name="l00239"></a>00239              call <a class="code" href="xmlreader_8f90.html#adc42635b06990dc0b52ab774961136d6">write_prolog</a>
<a name="l00240"></a>00240          <span class="keyword">endif</span>
<a name="l00241"></a>00241          <span class="keyword">if</span> ( begin_loop .or. begin_main_loop ) <span class="keyword">then</span>
<a name="l00242"></a>00242             begin_main_loop = .false.
<a name="l00243"></a>00243             call <a class="code" href="xmlreader_8f90.html#aa8c9a11ca28b1ede2a9be94c44eabc37">add_begin_loop</a>( .true., .false. )
<a name="l00244"></a>00244          <span class="keyword">endif</span>
<a name="l00245"></a>00245          call <a class="code" href="xmlreader_8f90.html#ad4ebeea0fdbbd5ae906ed5b33b1834f0">add_placeholder</a>(dyn_strings)
<a name="l00246"></a>00246          begin_component = .false.
<a name="l00247"></a>00247          luwrv = luwrite
<a name="l00248"></a>00248 
<a name="l00249"></a>00249       <span class="keyword">case</span>( <span class="stringliteral">&#39;typedef&#39;</span> )
<a name="l00250"></a>00250          <span class="keyword">if</span> ( .not. prolog_written ) <span class="keyword">then</span>
<a name="l00251"></a>00251              prolog_written = .true.
<a name="l00252"></a>00252              call <a class="code" href="xmlreader_8f90.html#adc42635b06990dc0b52ab774961136d6">write_prolog</a>
<a name="l00253"></a>00253          <span class="keyword">endif</span>
<a name="l00254"></a>00254          call <a class="code" href="xmlreader_8f90.html#aa47d469919b171944994a78b3e9ac048">add_typedef</a>(dyn_strings)
<a name="l00255"></a>00255 
<a name="l00256"></a>00256       <span class="keyword">case</span>( <span class="stringliteral">&#39;variable&#39;</span> )
<a name="l00257"></a>00257          <span class="keyword">if</span> ( .not. prolog_written ) <span class="keyword">then</span>
<a name="l00258"></a>00258              prolog_written = .true.
<a name="l00259"></a>00259              call <a class="code" href="xmlreader_8f90.html#adc42635b06990dc0b52ab774961136d6">write_prolog</a>
<a name="l00260"></a>00260          <span class="keyword">endif</span>
<a name="l00261"></a>00261          <span class="keyword">if</span> ( begin_loop .or. begin_main_loop ) <span class="keyword">then</span>
<a name="l00262"></a>00262             begin_main_loop = .false.
<a name="l00263"></a>00263             call <a class="code" href="xmlreader_8f90.html#aa8c9a11ca28b1ede2a9be94c44eabc37">add_begin_loop</a>( .true., begin_component )
<a name="l00264"></a>00264          <span class="keyword">endif</span>
<a name="l00265"></a>00265          call <a class="code" href="xmlreader_8f90.html#afef67cabfe69dc511d8fe06ef921a51d">add_variable</a>( component=comp )
<a name="l00266"></a>00266 
<a name="l00267"></a>00267       <span class="keyword">case</span>( <span class="stringliteral">&#39;component&#39;</span> )
<a name="l00268"></a>00268          <span class="comment">!</span>
<a name="l00269"></a>00269          <span class="comment">! Components of derived types are treated in much the</span>
<a name="l00270"></a>00270          <span class="comment">! same way as ordinary variables - with one syntactic</span>
<a name="l00271"></a>00271          <span class="comment">! difference</span>
<a name="l00272"></a>00272          <span class="comment">!</span>
<a name="l00273"></a>00273          <span class="keyword">if</span> ( .not. prolog_written ) <span class="keyword">then</span>
<a name="l00274"></a>00274              prolog_written = .true.
<a name="l00275"></a>00275              call <a class="code" href="xmlreader_8f90.html#adc42635b06990dc0b52ab774961136d6">write_prolog</a>
<a name="l00276"></a>00276          <span class="keyword">endif</span>
<a name="l00277"></a>00277          <span class="keyword">if</span> ( begin_loop ) <span class="keyword">then</span>
<a name="l00278"></a>00278             call <a class="code" href="xmlreader_8f90.html#aa8c9a11ca28b1ede2a9be94c44eabc37">add_begin_loop</a>( .true., .true. )
<a name="l00279"></a>00279          <span class="keyword">endif</span>
<a name="l00280"></a>00280          call <a class="code" href="xmlreader_8f90.html#afef67cabfe69dc511d8fe06ef921a51d">add_variable</a>( component=.true. )
<a name="l00281"></a>00281          begin_component = .true.
<a name="l00282"></a>00282 
<a name="l00283"></a>00283       <span class="keyword">case</span> default
<a name="l00284"></a>00284          <span class="keyword">write</span>(20,*) <span class="stringliteral">&#39;Unknown tag: &#39;</span>,trim(tag)
<a name="l00285"></a>00285          <span class="keyword">write</span>(20,*) <span class="stringliteral">&#39;-- terminating the program!&#39;</span>
<a name="l00286"></a>00286          stop
<a name="l00287"></a>00287       <span class="keyword">end select</span>
<a name="l00288"></a>00288    <span class="keyword">end do</span>
<a name="l00289"></a>00289 
<a name="l00290"></a>00290    <span class="comment">!</span>
<a name="l00291"></a>00291    <span class="comment">! Now finish it all</span>
<a name="l00292"></a>00292    <span class="comment">!</span>
<a name="l00293"></a>00293    <span class="keyword">write</span>( luend, <span class="stringliteral">&#39;(a)&#39;</span> ) &amp;
<a name="l00294"></a>00294       &amp; <span class="stringliteral">&#39;   if ( present(errout) ) errout = error&#39;</span>, &amp;
<a name="l00295"></a>00295       &amp; <span class="stringliteral">&#39;   call xml_close(info)&#39;</span>, &amp;
<a name="l00296"></a>00296       &amp; <span class="stringliteral">&#39;end subroutine&#39;</span>, &amp;
<a name="l00297"></a>00297       &amp; <span class="stringliteral">&#39; &#39;</span>
<a name="l00298"></a>00298    <span class="keyword">write</span>( luwritp, <span class="stringliteral">&#39;(a)&#39;</span> ) &amp;
<a name="l00299"></a>00299       &amp; <span class="stringliteral">&#39;   write(info%lun,&#39;</span><span class="stringliteral">&#39;(a)&#39;</span><span class="stringliteral">&#39;) &#39;</span><span class="stringliteral">&#39;&lt;/&#39;</span> // trim(root_name) // <span class="stringliteral">&#39;&gt;&#39;</span><span class="stringliteral">&#39;&#39;</span>, &amp;
<a name="l00300"></a>00300       &amp; <span class="stringliteral">&#39;   call xml_close(info)&#39;</span>, &amp;
<a name="l00301"></a>00301       &amp; <span class="stringliteral">&#39;end subroutine&#39;</span>, &amp;
<a name="l00302"></a>00302       &amp; <span class="stringliteral">&#39; &#39;</span>
<a name="l00303"></a>00303 
<a name="l00304"></a>00304    call <a class="code" href="xmlreader_8f90.html#a997ec57f386db45f4934ad33def2efca">append_files</a>( luprolog )
<a name="l00305"></a>00305    call <a class="code" href="xmlreader_8f90.html#a6389fe3b7c8a6014f81db3ca740c7e3a">merge_files</a>
<a name="l00306"></a>00306 
<a name="l00307"></a>00307    <span class="keyword">write</span>( ludef, <span class="stringliteral">&#39;(/,a)&#39;</span> ) &amp;
<a name="l00308"></a>00308       &amp; <span class="stringliteral">&#39;end subroutine&#39;</span>, &amp;
<a name="l00309"></a>00309       &amp; <span class="stringliteral">&#39;end module&#39;</span>
<a name="l00310"></a>00310 
<a name="l00311"></a>00311    <span class="keyword">if</span> ( error ) <span class="keyword">then</span>
<a name="l00312"></a>00312        <span class="keyword">write</span>(*,*) <span class="stringliteral">&#39;Errors found in the definition - please check!&#39;</span>
<a name="l00313"></a>00313    <span class="keyword">endif</span>
<a name="l00314"></a>00314    stop
<a name="l00315"></a>00315 <span class="keyword">contains</span>
<a name="l00316"></a>00316 
<a name="l00317"></a>00317 <span class="comment">!===============================================================================</span>
<a name="l00318"></a>00318 <span class="comment">! GET_GLOBAL_OPTIONS --</span>
<a name="l00319"></a>00319 <span class="comment">!    Routine to get the global options from the configuration file</span>
<a name="l00320"></a>00320 <span class="comment">! Arguments:</span>
<a name="l00321"></a>00321 <span class="comment">!    strict            Option to make the parser check for unknown tags</span>
<a name="l00322"></a>00322 <span class="comment">!    global_type       Option to generate an overall derived type</span>
<a name="l00323"></a>00323 <span class="comment">!    global_name       Name of that overall derived type (if requested)</span>
<a name="l00324"></a>00324 <span class="comment">!    root_name         Name of the root element of the XML file</span>
<a name="l00325"></a>00325 <span class="comment">!    dyn_strings       Whether to use dynamic strings or not</span>
<a name="l00326"></a>00326 <span class="comment">!===============================================================================</span>
<a name="l00327"></a>00327 
<a name="l00328"></a><a class="code" href="xmlreader_8f90.html#a749f0ad768591d470d09730ee7d44db3">00328</a> <span class="keyword">subroutine </span><a class="code" href="xmlreader_8f90.html#a749f0ad768591d470d09730ee7d44db3">get_global_options</a>( attribs, noattribs, strict, global_type, global_name, &amp;
<a name="l00329"></a>00329                                root_name, dyn_strings )
<a name="l00330"></a>00330    <span class="keywordtype">character(len=*)</span>, <span class="keywordtype">dimension(:,:)</span>, <span class="keywordtype">intent(inout)</span> :: attribs
<a name="l00331"></a>00331    <span class="keywordtype">integer</span>, <span class="keywordtype">intent(inout)</span>                          :: noattribs
<a name="l00332"></a>00332    <span class="keywordtype">logical</span>, <span class="keywordtype">intent(inout)</span>                          :: strict
<a name="l00333"></a>00333    <span class="keywordtype">logical</span>, <span class="keywordtype">intent(inout)</span>                          :: global_type
<a name="l00334"></a>00334    <span class="keywordtype">character(len=*)</span>, <span class="keywordtype">intent(inout)</span>                 :: global_name
<a name="l00335"></a>00335    <span class="keywordtype">character(len=*)</span>, <span class="keywordtype">intent(inout)</span>                 :: root_name
<a name="l00336"></a>00336    <span class="keywordtype">logical</span>, <span class="keywordtype">intent(inout)</span>                          :: dyn_strings
<a name="l00337"></a>00337 
<a name="l00338"></a>00338    <span class="keywordtype">character(len=20)</span>                               :: tag
<a name="l00339"></a>00339    <span class="keywordtype">character(len=20)</span>, <span class="keywordtype">dimension(1)</span>                 :: data
<a name="l00340"></a>00340    <span class="keywordtype">integer</span>                                         :: nodata
<a name="l00341"></a>00341    <span class="keywordtype">logical</span>                                         :: exists
<a name="l00342"></a>00342    <span class="keywordtype">logical</span>                                         :: endtag
<a name="l00343"></a>00343    <span class="keywordtype">type(XML_PARSE)</span>                                 :: info
<a name="l00344"></a>00344 
<a name="l00345"></a>00345    <span class="keyword">inquire</span>( file = <span class="stringliteral">&#39;xmlreader.conf&#39;</span>, exist = exists )
<a name="l00346"></a>00346    <span class="keyword">if</span> ( exists ) <span class="keyword">then</span>
<a name="l00347"></a>00347        call <a class="code" href="namespacexmlparse.html#ae06195e892d5b0715d0654adec1b9b10">xml_open</a>( info, <span class="stringliteral">&#39;xmlreader.conf&#39;</span>, .true. )
<a name="l00348"></a>00348        <span class="keyword">do</span> <span class="keyword">while</span> ( <a class="code" href="namespacexmlparse.html#a2a906a54d0b5956b8aa809c90aa82c38">xml_ok</a>(info) )
<a name="l00349"></a>00349           call <a class="code" href="namespacexmlparse.html#a282354b1e411ce4bad44768c57138777">xml_get</a>( info, tag, endtag, attribs, noattribs, <span class="keyword">data</span>, nodata )
<a name="l00350"></a>00350           <span class="keyword">if</span> ( tag == <span class="stringliteral">&#39;xmlreader&#39;</span> ) <span class="keyword">then</span>
<a name="l00351"></a>00351               call <a class="code" href="xmlreader_8f90.html#a11d0d26158fd59056145256cb88b73f2">set_options</a>( attribs, noattribs, strict, global_type, &amp;
<a name="l00352"></a>00352                                 global_name, root_name, dyn_strings )
<a name="l00353"></a>00353           <span class="keyword">endif</span>
<a name="l00354"></a>00354        <span class="keyword">enddo</span>
<a name="l00355"></a>00355        call <a class="code" href="namespacexmlparse.html#a5e7902dcce63348252ee46fe07959eaf">xml_close</a>( info )
<a name="l00356"></a>00356    <span class="keyword">endif</span>
<a name="l00357"></a>00357 <span class="keyword">end subroutine get_global_options</span>
<a name="l00358"></a>00358 
<a name="l00359"></a>00359 <span class="comment">!===============================================================================</span>
<a name="l00360"></a>00360 <span class="comment">! SET_OPTIONS --</span>
<a name="l00361"></a>00361 <span class="comment">!    Routine to set the options that influence the parser</span>
<a name="l00362"></a>00362 <span class="comment">! Arguments:</span>
<a name="l00363"></a>00363 <span class="comment">!    attribs           List of attributes</span>
<a name="l00364"></a>00364 <span class="comment">!    noattribs         Number of attributes</span>
<a name="l00365"></a>00365 <span class="comment">!    strict            Option to make the parser check for unknown tags</span>
<a name="l00366"></a>00366 <span class="comment">!    global_type       Option to generate an overall derived type</span>
<a name="l00367"></a>00367 <span class="comment">!    global_name       Name of that overall derived type (if requested)</span>
<a name="l00368"></a>00368 <span class="comment">!    root_name         Name of the root element of the XML file</span>
<a name="l00369"></a>00369 <span class="comment">!    dyn_strings       Whether to use dynamic strings or not</span>
<a name="l00370"></a>00370 <span class="comment">!===============================================================================</span>
<a name="l00371"></a>00371 
<a name="l00372"></a><a class="code" href="xmlreader_8f90.html#a11d0d26158fd59056145256cb88b73f2">00372</a> <span class="keyword">subroutine </span><a class="code" href="xmlreader_8f90.html#a11d0d26158fd59056145256cb88b73f2">set_options</a>( attribs, noattribs, strict, global_type, global_name, root_name, dyn_strings )
<a name="l00373"></a>00373    <span class="keywordtype">character(len=*)</span>, <span class="keywordtype">dimension(:,:)</span>, <span class="keywordtype">intent(in)</span> :: attribs
<a name="l00374"></a>00374    <span class="keywordtype">integer</span>, <span class="keywordtype">intent(in)</span>                          :: noattribs
<a name="l00375"></a>00375    <span class="keywordtype">logical</span>, <span class="keywordtype">intent(inout)</span>                       :: strict
<a name="l00376"></a>00376    <span class="keywordtype">logical</span>, <span class="keywordtype">intent(inout)</span>                       :: global_type
<a name="l00377"></a>00377    <span class="keywordtype">character(len=*)</span>, <span class="keywordtype">intent(inout)</span>              :: global_name
<a name="l00378"></a>00378    <span class="keywordtype">character(len=*)</span>, <span class="keywordtype">intent(inout)</span>              :: root_name
<a name="l00379"></a>00379    <span class="keywordtype">logical</span>, <span class="keywordtype">intent(inout)</span>                       :: dyn_strings
<a name="l00380"></a>00380 
<a name="l00381"></a>00381    <span class="keywordtype">integer</span> :: i
<a name="l00382"></a>00382 
<a name="l00383"></a>00383    <span class="keyword">do</span> i = 1,noattribs
<a name="l00384"></a>00384       <span class="keyword">select</span> <span class="keyword">case</span> (attribs(1,i))
<a name="l00385"></a>00385       <span class="keyword">case</span> (<span class="stringliteral">&#39;strict&#39;</span>)
<a name="l00386"></a>00386          <span class="keyword">if</span> ( attribs(2,i) == <span class="stringliteral">&#39;yes&#39;</span> ) <span class="keyword">then</span>
<a name="l00387"></a>00387             strict = .true.
<a name="l00388"></a>00388          <span class="keyword">else</span>
<a name="l00389"></a>00389             strict = .false.
<a name="l00390"></a>00390          <span class="keyword">endif</span>
<a name="l00391"></a>00391       <span class="keyword">case</span> (<span class="stringliteral">&#39;globaltype&#39;</span>)
<a name="l00392"></a>00392          <span class="keyword">if</span> ( attribs(2,i) == <span class="stringliteral">&#39;yes&#39;</span> ) <span class="keyword">then</span>
<a name="l00393"></a>00393             global_type = .true.
<a name="l00394"></a>00394          <span class="keyword">else</span>
<a name="l00395"></a>00395             global_type = .false.
<a name="l00396"></a>00396          <span class="keyword">endif</span>
<a name="l00397"></a>00397       <span class="keyword">case</span> (<span class="stringliteral">&#39;globalname&#39;</span>)
<a name="l00398"></a>00398          global_name = attribs(2,i)
<a name="l00399"></a>00399       <span class="keyword">case</span> (<span class="stringliteral">&#39;rootname&#39;</span>)
<a name="l00400"></a>00400          root_name = attribs(2,i)
<a name="l00401"></a>00401       <span class="keyword">case</span> (<span class="stringliteral">&#39;dynamicstrings&#39;</span>)
<a name="l00402"></a>00402          <span class="keyword">if</span> ( attribs(2,i) == <span class="stringliteral">&#39;yes&#39;</span> ) <span class="keyword">then</span>
<a name="l00403"></a>00403             dyn_strings = .true.
<a name="l00404"></a>00404          <span class="keyword">else</span>
<a name="l00405"></a>00405             dyn_strings = .false.
<a name="l00406"></a>00406          <span class="keyword">endif</span>
<a name="l00407"></a>00407       <span class="keyword">case</span> default
<a name="l00408"></a>00408          <span class="keyword">write</span>(20,*) <span class="stringliteral">&#39;Unknown option: &#39;</span>,trim(attribs(1,i)), <span class="stringliteral">&#39; - ignored&#39;</span>
<a name="l00409"></a>00409       <span class="keyword">end select</span>
<a name="l00410"></a>00410    <span class="keyword">enddo</span>
<a name="l00411"></a>00411 <span class="keyword">end subroutine set_options</span>
<a name="l00412"></a>00412 
<a name="l00413"></a>00413 <span class="comment">!===============================================================================</span>
<a name="l00414"></a>00414 <span class="comment">! OPEN_TMP_FILES --</span>
<a name="l00415"></a>00415 <span class="comment">!    Routine to open the temporary files</span>
<a name="l00416"></a>00416 <span class="comment">! Arguments:</span>
<a name="l00417"></a>00417 <span class="comment">!    lufirst           First LU-number to use</span>
<a name="l00418"></a>00418 <span class="comment">!===============================================================================</span>
<a name="l00419"></a>00419 
<a name="l00420"></a><a class="code" href="xmlreader_8f90.html#a0d4c0b96aed4f686ec75542ed9c8c01e">00420</a> <span class="keyword">subroutine </span><a class="code" href="xmlreader_8f90.html#a0d4c0b96aed4f686ec75542ed9c8c01e">open_tmp_files</a>( lufirst )
<a name="l00421"></a>00421    <span class="keywordtype">integer</span>, <span class="keywordtype">intent(in)</span> :: lufirst
<a name="l00422"></a>00422 
<a name="l00423"></a>00423    luprolog = lufirst
<a name="l00424"></a>00424    lustart  = lufirst + 1
<a name="l00425"></a>00425    luloop   = lufirst + 2
<a name="l00426"></a>00426    luend    = lufirst + 3
<a name="l00427"></a>00427    ludeflt  = lufirst + 4
<a name="l00428"></a>00428    luwrite  = lufirst + 5
<a name="l00429"></a>00429    <span class="keyword">open</span>( luprolog, status = <span class="stringliteral">&#39;scratch&#39;</span> )
<a name="l00430"></a>00430    <span class="keyword">open</span>( lustart,  status = <span class="stringliteral">&#39;scratch&#39;</span> )
<a name="l00431"></a>00431    <span class="keyword">open</span>( luloop,   status = <span class="stringliteral">&#39;scratch&#39;</span> )
<a name="l00432"></a>00432    <span class="keyword">open</span>( luend,    status = <span class="stringliteral">&#39;scratch&#39;</span> )
<a name="l00433"></a>00433    <span class="keyword">open</span>( ludeflt,  status = <span class="stringliteral">&#39;scratch&#39;</span> )
<a name="l00434"></a>00434    <span class="keyword">open</span>( luwrite,  status = <span class="stringliteral">&#39;scratch&#39;</span> )
<a name="l00435"></a>00435 <span class="keyword">end subroutine open_tmp_files</span>
<a name="l00436"></a>00436 
<a name="l00437"></a>00437 <span class="comment">!===============================================================================</span>
<a name="l00438"></a>00438 <span class="comment">! CLOSE_TMP_FILES --</span>
<a name="l00439"></a>00439 <span class="comment">!    Routine to close the temporary files</span>
<a name="l00440"></a>00440 <span class="comment">! Arguments:</span>
<a name="l00441"></a>00441 <span class="comment">!    None</span>
<a name="l00442"></a>00442 <span class="comment">!===============================================================================</span>
<a name="l00443"></a>00443 
<a name="l00444"></a><a class="code" href="xmlreader_8f90.html#afa5569ea1a3d70f4d3fa00bd102ab729">00444</a> <span class="keyword">subroutine </span><a class="code" href="xmlreader_8f90.html#afa5569ea1a3d70f4d3fa00bd102ab729">close_tmp_files</a>
<a name="l00445"></a>00445    <span class="keyword">close</span>( luprolog )
<a name="l00446"></a>00446    <span class="keyword">close</span>( lustart  )
<a name="l00447"></a>00447    <span class="keyword">close</span>( luloop   )
<a name="l00448"></a>00448    <span class="keyword">close</span>( luend    )
<a name="l00449"></a>00449    <span class="keyword">close</span>( ludeflt  )
<a name="l00450"></a>00450    <span class="keyword">close</span>( luwrite  )
<a name="l00451"></a>00451 
<a name="l00452"></a>00452    luprolog = luprolog - notmps
<a name="l00453"></a>00453    lustart  = lustart  - notmps
<a name="l00454"></a>00454    luloop   = luloop   - notmps
<a name="l00455"></a>00455    luend    = luend    - notmps
<a name="l00456"></a>00456    ludeflt  = ludeflt  - notmps
<a name="l00457"></a>00457    luwrite  = luwrite  - notmps
<a name="l00458"></a>00458 <span class="keyword">end subroutine close_tmp_files</span>
<a name="l00459"></a>00459 
<a name="l00460"></a>00460 <span class="comment">!===============================================================================</span>
<a name="l00461"></a>00461 <span class="comment">! APPEND_TMP_FILES --</span>
<a name="l00462"></a>00462 <span class="comment">!    Routine to append the contents of the temporary files</span>
<a name="l00463"></a>00463 <span class="comment">! Arguments:</span>
<a name="l00464"></a>00464 <span class="comment">!    lufirst           First LU-number to use</span>
<a name="l00465"></a>00465 <span class="comment">!===============================================================================</span>
<a name="l00466"></a>00466 
<a name="l00467"></a><a class="code" href="xmlreader_8f90.html#a997ec57f386db45f4934ad33def2efca">00467</a> <span class="keyword">subroutine </span><a class="code" href="xmlreader_8f90.html#a997ec57f386db45f4934ad33def2efca">append_files</a>( lufirst )
<a name="l00468"></a>00468    <span class="keywordtype">integer</span>, <span class="keywordtype">intent(in)</span> :: lufirst
<a name="l00469"></a>00469 
<a name="l00470"></a>00470    <span class="keywordtype">integer</span>             :: lu
<a name="l00471"></a>00471    <span class="keywordtype">integer</span>             :: io
<a name="l00472"></a>00472    <span class="keywordtype">character(len=120)</span>  :: line
<a name="l00473"></a>00473 
<a name="l00474"></a>00474    <span class="comment">!</span>
<a name="l00475"></a>00475    <span class="comment">! If we have not written a subroutine yet, then</span>
<a name="l00476"></a>00476    <span class="comment">! now is the time to close the overall initialisation</span>
<a name="l00477"></a>00477    <span class="comment">! routine</span>
<a name="l00478"></a>00478    <span class="comment">! -- no longer needed</span>
<a name="l00479"></a>00479    <span class="comment">!</span>
<a name="l00480"></a>00480    <span class="comment">!if ( .not. contains ) then</span>
<a name="l00481"></a>00481    <span class="comment">!   write( lusubs, &#39;(a,/)&#39; ) &#39;end subroutine&#39;</span>
<a name="l00482"></a>00482    <span class="comment">!   contains = .true.</span>
<a name="l00483"></a>00483    <span class="comment">!endif</span>
<a name="l00484"></a>00484 
<a name="l00485"></a>00485    <span class="comment">!</span>
<a name="l00486"></a>00486    <span class="comment">! Copy the contents of the scratch files</span>
<a name="l00487"></a>00487    <span class="comment">!</span>
<a name="l00488"></a>00488    <span class="keyword">do</span> lu = lufirst,lufirst+notmps-1
<a name="l00489"></a>00489       rewind( lu )
<a name="l00490"></a>00490       <span class="keyword">do</span>
<a name="l00491"></a>00491          <span class="keyword">read</span>( lu, <span class="stringliteral">&#39;(a)&#39;</span>, iostat=io ) line
<a name="l00492"></a>00492          <span class="keyword">if</span> ( io /= 0 ) exit
<a name="l00493"></a>00493          <span class="keyword">write</span>( lusubs, <span class="stringliteral">&#39;(a)&#39;</span> ) trim(line)
<a name="l00494"></a>00494       <span class="keyword">enddo</span>
<a name="l00495"></a>00495       rewind( lu )
<a name="l00496"></a>00496    <span class="keyword">enddo</span>
<a name="l00497"></a>00497 <span class="keyword">end subroutine append_files</span>
<a name="l00498"></a>00498 
<a name="l00499"></a>00499 <span class="comment">!===============================================================================</span>
<a name="l00500"></a>00500 <span class="comment">! MERGE_FILES --</span>
<a name="l00501"></a>00501 <span class="comment">!    Routine to merge all temporary files into the definite file</span>
<a name="l00502"></a>00502 <span class="comment">! Arguments:</span>
<a name="l00503"></a>00503 <span class="comment">!    None</span>
<a name="l00504"></a>00504 <span class="comment">!===============================================================================</span>
<a name="l00505"></a>00505 
<a name="l00506"></a><a class="code" href="xmlreader_8f90.html#a6389fe3b7c8a6014f81db3ca740c7e3a">00506</a> <span class="keyword">subroutine </span><a class="code" href="xmlreader_8f90.html#a6389fe3b7c8a6014f81db3ca740c7e3a">merge_files</a>
<a name="l00507"></a>00507 
<a name="l00508"></a>00508    <span class="keywordtype">integer</span>             :: io
<a name="l00509"></a>00509    <span class="keywordtype">character(len=120)</span>  :: line
<a name="l00510"></a>00510 
<a name="l00511"></a>00511    <span class="comment">!</span>
<a name="l00512"></a>00512    <span class="comment">! Copy the contents of the &quot;subroutines&quot; file</span>
<a name="l00513"></a>00513    <span class="comment">!</span>
<a name="l00514"></a>00514    rewind( lusubs )
<a name="l00515"></a>00515    <span class="keyword">do</span>
<a name="l00516"></a>00516       <span class="keyword">read</span>( lusubs, <span class="stringliteral">&#39;(a)&#39;</span>, iostat=io ) line
<a name="l00517"></a>00517       <span class="keyword">if</span> ( io /= 0 ) exit
<a name="l00518"></a>00518       <span class="keyword">write</span>( ludef, <span class="stringliteral">&#39;(a)&#39;</span> ) trim(line)
<a name="l00519"></a>00519    <span class="keyword">enddo</span>
<a name="l00520"></a>00520 
<a name="l00521"></a>00521    <span class="comment">!</span>
<a name="l00522"></a>00522    <span class="comment">! Copy the contents of the &quot;write xml file subroutine&quot; file</span>
<a name="l00523"></a>00523    <span class="comment">!</span>
<a name="l00524"></a>00524    rewind( luwritp )
<a name="l00525"></a>00525    <span class="keyword">do</span>
<a name="l00526"></a>00526       <span class="keyword">read</span>( luwritp, <span class="stringliteral">&#39;(a)&#39;</span>, iostat=io ) line
<a name="l00527"></a>00527       <span class="keyword">if</span> ( io /= 0 ) exit
<a name="l00528"></a>00528       <span class="keyword">write</span>( ludef, <span class="stringliteral">&#39;(a)&#39;</span> ) trim(line)
<a name="l00529"></a>00529    <span class="keyword">enddo</span>
<a name="l00530"></a>00530 
<a name="l00531"></a>00531    <span class="comment">!</span>
<a name="l00532"></a>00532    <span class="comment">! Copy the contents of the &quot;initialisation subroutine&quot; file</span>
<a name="l00533"></a>00533    <span class="comment">!</span>
<a name="l00534"></a>00534    rewind( luinit )
<a name="l00535"></a>00535    <span class="keyword">do</span>
<a name="l00536"></a>00536       <span class="keyword">read</span>( luinit, <span class="stringliteral">&#39;(a)&#39;</span>, iostat=io ) line
<a name="l00537"></a>00537       <span class="keyword">if</span> ( io /= 0 ) exit
<a name="l00538"></a>00538       <span class="keyword">write</span>( ludef, <span class="stringliteral">&#39;(a)&#39;</span> ) trim(line)
<a name="l00539"></a>00539    <span class="keyword">enddo</span>
<a name="l00540"></a>00540 <span class="keyword">end subroutine merge_files</span>
<a name="l00541"></a>00541 
<a name="l00542"></a>00542 <span class="comment">!===============================================================================</span>
<a name="l00543"></a>00543 <span class="comment">! WRITE_PROLOG --</span>
<a name="l00544"></a>00544 <span class="comment">!    Routine to write the beginning of the module</span>
<a name="l00545"></a>00545 <span class="comment">! Arguments:</span>
<a name="l00546"></a>00546 <span class="comment">!    None</span>
<a name="l00547"></a>00547 <span class="comment">!===============================================================================</span>
<a name="l00548"></a>00548 
<a name="l00549"></a><a class="code" href="xmlreader_8f90.html#adc42635b06990dc0b52ab774961136d6">00549</a> <span class="keyword">subroutine </span><a class="code" href="xmlreader_8f90.html#adc42635b06990dc0b52ab774961136d6">write_prolog</a>
<a name="l00550"></a>00550    <span class="keyword">write</span>( ludef, <span class="stringliteral">&#39;(a)&#39;</span> ) &amp;
<a name="l00551"></a>00551   &amp;   <span class="stringliteral">&#39;module xml_data_&#39;</span> // trim(fname), &amp;
<a name="l00552"></a>00552   &amp;   <span class="stringliteral">&#39;   use READ_XML_PRIMITIVES&#39;</span>, &amp;
<a name="l00553"></a>00553   &amp;   <span class="stringliteral">&#39;   use WRITE_XML_PRIMITIVES&#39;</span>, &amp;
<a name="l00554"></a>00554   &amp;   <span class="stringliteral">&#39;   use XMLPARSE&#39;</span>, &amp;
<a name="l00555"></a>00555   &amp;   <span class="stringliteral">&#39;   implicit none&#39;</span>, &amp;
<a name="l00556"></a>00556   &amp;   <span class="stringliteral">&#39;   save&#39;</span>, &amp;
<a name="l00557"></a>00557   &amp;   <span class="stringliteral">&#39;   integer, private :: lurep_&#39;</span>, &amp;
<a name="l00558"></a>00558   &amp;   <span class="stringliteral">&#39;   logical, private :: strict_&#39;</span>
<a name="l00559"></a>00559 
<a name="l00560"></a>00560    <span class="keyword">write</span>( luprolog, <span class="stringliteral">&#39;(a)&#39;</span> ) &amp;
<a name="l00561"></a>00561   &amp;   <span class="stringliteral">&#39;subroutine read_xml_file_&#39;</span>//trim(fname)//<span class="stringliteral">&#39;(fname, lurep, errout)&#39;</span> , &amp;
<a name="l00562"></a>00562   &amp;   <span class="stringliteral">&#39;   character(len=*), intent(in)           :: fname&#39;</span>     , &amp;
<a name="l00563"></a>00563   &amp;   <span class="stringliteral">&#39;   integer, intent(in), optional          :: lurep&#39;</span>     , &amp;
<a name="l00564"></a>00564   &amp;   <span class="stringliteral">&#39;   logical, intent(out), optional         :: errout&#39;</span>    , &amp;
<a name="l00565"></a>00565   &amp;   <span class="stringliteral">&#39;   &#39;</span>                                                    , &amp;
<a name="l00566"></a>00566   &amp;   <span class="stringliteral">&#39;   type(XML_PARSE)                        :: info&#39;</span>      , &amp;
<a name="l00567"></a>00567   &amp;   <span class="stringliteral">&#39;   logical                                :: error&#39;</span>     , &amp;
<a name="l00568"></a>00568   &amp;   <span class="stringliteral">&#39;   character(len=80)                      :: tag&#39;</span>       , &amp;
<a name="l00569"></a>00569   &amp;   <span class="stringliteral">&#39;   character(len=80)                      :: starttag&#39;</span>  , &amp;
<a name="l00570"></a>00570   &amp;   <span class="stringliteral">&#39;   logical                                :: endtag&#39;</span>    , &amp;
<a name="l00571"></a>00571   &amp;   <span class="stringliteral">&#39;   character(len=80), dimension(1:2,1:20) :: attribs&#39;</span>   , &amp;
<a name="l00572"></a>00572   &amp;   <span class="stringliteral">&#39;   integer                                :: noattribs&#39;</span> , &amp;
<a name="l00573"></a>00573   &amp;   <span class="stringliteral">&#39;   character(len=100000), dimension(1:1000)  :: data&#39;</span>      , &amp;
<a name="l00574"></a>00574   &amp;   <span class="stringliteral">&#39;   integer                                :: nodata&#39;</span>
<a name="l00575"></a>00575 
<a name="l00576"></a>00576    <span class="keyword">write</span>( lusubs, <span class="stringliteral">&#39;(a)&#39;</span> ) &amp;
<a name="l00577"></a>00577   &amp;   <span class="stringliteral">&#39;contains&#39;</span>
<a name="l00578"></a>00578    <span class="keyword">write</span>( luinit, <span class="stringliteral">&#39;(a)&#39;</span> ) &amp;
<a name="l00579"></a>00579   &amp;   <span class="stringliteral">&#39;subroutine init_xml_file_&#39;</span>//trim(fname)
<a name="l00580"></a>00580 
<a name="l00581"></a>00581    <span class="keyword">write</span>( luwritp, <span class="stringliteral">&#39;(a)&#39;</span> ) &amp;
<a name="l00582"></a>00582   &amp;   <span class="stringliteral">&#39;subroutine write_xml_file_&#39;</span>//trim(fname)//<span class="stringliteral">&#39;(fname, lurep)&#39;</span> , &amp;
<a name="l00583"></a>00583   &amp;   <span class="stringliteral">&#39;   character(len=*), intent(in)           :: fname&#39;</span>     , &amp;
<a name="l00584"></a>00584   &amp;   <span class="stringliteral">&#39;   integer, intent(in), optional          :: lurep&#39;</span>     , &amp;
<a name="l00585"></a>00585   &amp;   <span class="stringliteral">&#39;   &#39;</span>                                                    , &amp;
<a name="l00586"></a>00586   &amp;   <span class="stringliteral">&#39;   type(XML_PARSE)                        :: info&#39;</span>      , &amp;
<a name="l00587"></a>00587   &amp;   <span class="stringliteral">&#39;   integer                                :: indent = 0&#39;</span>, &amp;
<a name="l00588"></a>00588   &amp;   <span class="stringliteral">&#39;   &#39;</span>                                                    , &amp;
<a name="l00589"></a>00589   &amp;   <span class="stringliteral">&#39;   call xml_open( info, fname, .false. )&#39;</span>               , &amp;
<a name="l00590"></a>00590   &amp;   <span class="stringliteral">&#39;   call xml_options( info, report_errors=.true.)&#39;</span>       , &amp;
<a name="l00591"></a>00591   &amp;   <span class="stringliteral">&#39;   if ( present(lurep) ) then&#39;</span>                          , &amp;
<a name="l00592"></a>00592   &amp;   <span class="stringliteral">&#39;       call xml_options( info, report_errors=.true.)&#39;</span>   , &amp;
<a name="l00593"></a>00593   &amp;   <span class="stringliteral">&#39;   endif&#39;</span>                                               , &amp;
<a name="l00594"></a>00594   &amp;   <span class="stringliteral">&#39;   write(info%lun,&#39;</span><span class="stringliteral">&#39;(a)&#39;</span><span class="stringliteral">&#39;) &amp;&#39;</span>                           , &amp;
<a name="l00595"></a>00595   &amp;   <span class="stringliteral">&#39;      &#39;</span><span class="stringliteral">&#39;&lt;&#39;</span> // trim(root_name) // <span class="stringliteral">&#39;&gt;&#39;</span><span class="stringliteral">&#39;&#39;</span>
<a name="l00596"></a>00596 
<a name="l00597"></a>00597    <span class="keyword">write</span>( lumain, <span class="stringliteral">&#39;(a)&#39;</span> ) &amp;
<a name="l00598"></a>00598       &amp;   <span class="stringliteral">&#39;   &#39;</span>, &amp;
<a name="l00599"></a>00599       &amp;   <span class="stringliteral">&#39;   call init_xml_file_&#39;</span>//trim(fname), &amp;
<a name="l00600"></a>00600       &amp;   <span class="stringliteral">&#39;   call xml_open( info, fname, .true. )&#39;</span>, &amp;
<a name="l00601"></a>00601       &amp;   <span class="stringliteral">&#39;   call xml_options( info, report_errors=.false., ignore_whitespace=.true.)&#39;</span>, &amp;
<a name="l00602"></a>00602       &amp;   <span class="stringliteral">&#39;   lurep_ = 0&#39;</span>, &amp;
<a name="l00603"></a>00603       &amp;   <span class="stringliteral">&#39;   if ( present(lurep) ) then&#39;</span>, &amp;
<a name="l00604"></a>00604       &amp;   <span class="stringliteral">&#39;      lurep_ = lurep&#39;</span>, &amp;
<a name="l00605"></a>00605       &amp;   <span class="stringliteral">&#39;      call xml_options( info, report_lun=lurep )&#39;</span>, &amp;
<a name="l00606"></a>00606       &amp;   <span class="stringliteral">&#39;   endif&#39;</span>, &amp;
<a name="l00607"></a>00607       &amp;   <span class="stringliteral">&#39;   do&#39;</span>, &amp;
<a name="l00608"></a>00608       &amp;   <span class="stringliteral">&#39;      call xml_get( info, starttag, endtag, attribs, noattribs, &amp;&#39;</span>, &amp;
<a name="l00609"></a>00609       &amp;   <span class="stringliteral">&#39;         data, nodata)&#39;</span>, &amp;
<a name="l00610"></a>00610       &amp;   <span class="stringliteral">&#39;      if ( starttag /= &#39;</span><span class="stringliteral">&#39;!--&#39;</span><span class="stringliteral">&#39; ) exit&#39;</span>, &amp;
<a name="l00611"></a>00611       &amp;   <span class="stringliteral">&#39;   enddo&#39;</span>, &amp;
<a name="l00612"></a>00612       &amp;   <span class="stringliteral">&#39;   if ( starttag /= &quot;&#39;</span> // trim(root_name) // <span class="stringliteral">&#39;&quot; ) then&#39;</span>, &amp;
<a name="l00613"></a>00613       &amp;   <span class="stringliteral">&#39;      call xml_report_errors( info, &amp;&#39;</span>, &amp;
<a name="l00614"></a>00614       &amp;   <span class="stringliteral">&#39;         &#39;</span><span class="stringliteral">&#39;XML-file should have root element &quot;&#39;</span> // trim(root_name) // <span class="stringliteral">&#39;&quot;&#39;</span><span class="stringliteral">&#39;)&#39;</span>, &amp;
<a name="l00615"></a>00615       &amp;   <span class="stringliteral">&#39;      error = .true.&#39;</span>, &amp;
<a name="l00616"></a>00616       &amp;   <span class="stringliteral">&#39;      call xml_close(info)&#39;</span>, &amp;
<a name="l00617"></a>00617       &amp;   <span class="stringliteral">&#39;      return&#39;</span>, &amp;
<a name="l00618"></a>00618       &amp;   <span class="stringliteral">&#39;   endif&#39;</span>
<a name="l00619"></a>00619 
<a name="l00620"></a>00620    call <a class="code" href="xmlreader_8f90.html#abc8f04613aa2829685f5c907e6443153">add_end_loop</a>
<a name="l00621"></a>00621 <span class="keyword">end subroutine write_prolog</span>
<a name="l00622"></a>00622 
<a name="l00623"></a>00623 <span class="comment">!===============================================================================</span>
<a name="l00624"></a>00624 <span class="comment">! ADD_BEGIN_LOOP --</span>
<a name="l00625"></a>00625 <span class="comment">!    Routine to write the start of the reading loop</span>
<a name="l00626"></a>00626 <span class="comment">! Arguments:</span>
<a name="l00627"></a>00627 <span class="comment">!    checktag        Whether code for checking the tag is required</span>
<a name="l00628"></a>00628 <span class="comment">!    component       Whether this is an ordinary variable or a component</span>
<a name="l00629"></a>00629 <span class="comment">!                    in a derived type</span>
<a name="l00630"></a>00630 <span class="comment">!===============================================================================</span>
<a name="l00631"></a>00631 
<a name="l00632"></a><a class="code" href="xmlreader_8f90.html#aa8c9a11ca28b1ede2a9be94c44eabc37">00632</a> <span class="keyword">subroutine </span><a class="code" href="xmlreader_8f90.html#aa8c9a11ca28b1ede2a9be94c44eabc37">add_begin_loop</a>( checktag, component )
<a name="l00633"></a>00633    <span class="keywordtype">logical</span>                                :: checktag
<a name="l00634"></a>00634    <span class="keywordtype">logical</span>                                :: component
<a name="l00635"></a>00635 
<a name="l00636"></a>00636    <span class="keyword">if</span> ( component ) <span class="keyword">then</span>
<a name="l00637"></a>00637       <span class="keyword">write</span>( luloop, <span class="stringliteral">&#39;(a)&#39;</span> ) &amp;
<a name="l00638"></a>00638   &amp;   <span class="stringliteral">&#39;   call init_xml_type_&#39;</span>//trim(typename)//<span class="stringliteral">&#39;(dvar)&#39;</span>, &amp;
<a name="l00639"></a>00639   &amp;   <span class="stringliteral">&#39;   has_dvar = .true.&#39;</span>
<a name="l00640"></a>00640    <span class="keyword">endif</span>
<a name="l00641"></a>00641 
<a name="l00642"></a>00642    begin_loop = .false.
<a name="l00643"></a>00643 
<a name="l00644"></a>00644    <span class="keyword">if</span> ( component ) <span class="keyword">then</span>
<a name="l00645"></a>00645       <span class="keyword">write</span>( luloop, <span class="stringliteral">&#39;(a)&#39;</span> ) &amp;
<a name="l00646"></a>00646      &amp;   <span class="stringliteral">&#39;   error  = .false.&#39;</span>     ,&amp;
<a name="l00647"></a>00647      &amp;   <span class="stringliteral">&#39;   att_   = 0&#39;</span>           ,&amp;
<a name="l00648"></a>00648      &amp;   <span class="stringliteral">&#39;   noatt_ = noattribs+1&#39;</span> ,&amp;
<a name="l00649"></a>00649      &amp;   <span class="stringliteral">&#39;   endtag_org = endtag&#39;</span>  ,&amp;
<a name="l00650"></a>00650      &amp;   <span class="stringliteral">&#39;   do&#39;</span>,  &amp;
<a name="l00651"></a>00651      &amp;   <span class="stringliteral">&#39;      if ( nodata /= 0 ) then&#39;</span>           ,&amp;
<a name="l00652"></a>00652      &amp;   <span class="stringliteral">&#39;         noattribs = 0&#39;</span>                    ,&amp;
<a name="l00653"></a>00653      &amp;   <span class="stringliteral">&#39;         tag = starttag&#39;</span>                   ,&amp;
<a name="l00654"></a>00654      &amp;   <span class="stringliteral">&#39;      elseif ( att_ &lt; noatt_ .and. noatt_ &gt; 1 ) then&#39;</span> ,&amp;
<a name="l00655"></a>00655      &amp;   <span class="stringliteral">&#39;         att_      = att_ + 1&#39;</span>             ,&amp;
<a name="l00656"></a>00656      &amp;   <span class="stringliteral">&#39;         if ( att_ &lt;= noatt_-1 ) then&#39;</span>   ,&amp;
<a name="l00657"></a>00657      &amp;   <span class="stringliteral">&#39;            tag       = attribs(1,att_)&#39;</span>   ,&amp;
<a name="l00658"></a>00658      &amp;   <span class="stringliteral">&#39;            data(1)   = attribs(2,att_)&#39;</span>   ,&amp;
<a name="l00659"></a>00659      &amp;   <span class="stringliteral">&#39;            noattribs = 0&#39;</span>                 ,&amp;
<a name="l00660"></a>00660      &amp;   <span class="stringliteral">&#39;            nodata    = 1&#39;</span>                 ,&amp;
<a name="l00661"></a>00661      &amp;   <span class="stringliteral">&#39;            endtag    = .false.&#39;</span>           ,&amp;
<a name="l00662"></a>00662      &amp;   <span class="stringliteral">&#39;         else&#39;</span>                             ,&amp;
<a name="l00663"></a>00663      &amp;   <span class="stringliteral">&#39;            tag       = starttag&#39;</span>          ,&amp;
<a name="l00664"></a>00664      &amp;   <span class="stringliteral">&#39;            noattribs = 0&#39;</span>                 ,&amp;
<a name="l00665"></a>00665      &amp;   <span class="stringliteral">&#39;            nodata    = 0&#39;</span>                 ,&amp;
<a name="l00666"></a>00666      &amp;   <span class="stringliteral">&#39;            endtag    = .true.&#39;</span>            ,&amp;
<a name="l00667"></a>00667      &amp;   <span class="stringliteral">&#39;            cycle&#39;</span>                         ,&amp;
<a name="l00668"></a>00668      &amp;   <span class="stringliteral">&#39;         endif&#39;</span>                            ,&amp;
<a name="l00669"></a>00669      &amp;   <span class="stringliteral">&#39;      else&#39;</span>, &amp;
<a name="l00670"></a>00670      &amp;   <span class="stringliteral">&#39;         if ( endtag_org ) then&#39;</span>, &amp;
<a name="l00671"></a>00671      &amp;   <span class="stringliteral">&#39;            return&#39;</span>, &amp;
<a name="l00672"></a>00672      &amp;   <span class="stringliteral">&#39;         else&#39;</span>, &amp;
<a name="l00673"></a>00673      &amp;   <span class="stringliteral">&#39;            call xml_get( info, tag, endtag, attribs, noattribs, data, nodata )&#39;</span> ,&amp;
<a name="l00674"></a>00674      &amp;   <span class="stringliteral">&#39;            if ( xml_error(info) ) then&#39;</span>                 ,&amp;
<a name="l00675"></a>00675      &amp;   <span class="stringliteral">&#39;               write(lurep_,*) &#39;</span><span class="stringliteral">&#39;Error reading input file!&#39;</span><span class="stringliteral">&#39;&#39;</span>,&amp;
<a name="l00676"></a>00676      &amp;   <span class="stringliteral">&#39;               error = .true.&#39;</span>                           ,&amp;
<a name="l00677"></a>00677      &amp;   <span class="stringliteral">&#39;               return&#39;</span>                                   ,&amp;
<a name="l00678"></a>00678      &amp;   <span class="stringliteral">&#39;            endif&#39;</span>                                       ,&amp;
<a name="l00679"></a>00679      &amp;   <span class="stringliteral">&#39;         endif&#39;</span>                                          ,&amp;
<a name="l00680"></a>00680      &amp;   <span class="stringliteral">&#39;      endif&#39;</span>
<a name="l00681"></a>00681    <span class="keyword">else</span>
<a name="l00682"></a>00682       <span class="keyword">write</span>( luloop, <span class="stringliteral">&#39;(a)&#39;</span> ) &amp;
<a name="l00683"></a>00683      &amp;   <span class="stringliteral">&#39;   error = .false.&#39;</span> ,&amp;
<a name="l00684"></a>00684      &amp;   <span class="stringliteral">&#39;   do&#39;</span>,  &amp;
<a name="l00685"></a>00685      &amp;   <span class="stringliteral">&#39;      call xml_get( info, tag, endtag, attribs, noattribs, data, nodata )&#39;</span> ,&amp;
<a name="l00686"></a>00686      &amp;   <span class="stringliteral">&#39;      if ( xml_error(info) ) then&#39;</span>                       ,&amp;
<a name="l00687"></a>00687      &amp;   <span class="stringliteral">&#39;         write(lurep_,*) &#39;</span><span class="stringliteral">&#39;Error reading input file!&#39;</span><span class="stringliteral">&#39;&#39;</span>  ,&amp;
<a name="l00688"></a>00688      &amp;   <span class="stringliteral">&#39;         error = .true.&#39;</span>                                 ,&amp;
<a name="l00689"></a>00689      &amp;   <span class="stringliteral">&#39;         return&#39;</span>                                         ,&amp;
<a name="l00690"></a>00690      &amp;   <span class="stringliteral">&#39;      endif&#39;</span>
<a name="l00691"></a>00691    <span class="keyword">endif</span>
<a name="l00692"></a>00692    <span class="keyword">if</span> ( checktag ) <span class="keyword">then</span>
<a name="l00693"></a>00693       <span class="keyword">write</span>( luloop, <span class="stringliteral">&#39;(a)&#39;</span> ) &amp;
<a name="l00694"></a>00694   &amp;   <span class="stringliteral">&#39;      if ( endtag .and. tag == starttag ) then&#39;</span>  ,&amp;
<a name="l00695"></a>00695   &amp;   <span class="stringliteral">&#39;         exit&#39;</span>                                     ,&amp;
<a name="l00696"></a>00696   &amp;   <span class="stringliteral">&#39;      endif&#39;</span>
<a name="l00697"></a>00697    <span class="keyword">endif</span>
<a name="l00698"></a>00698    <span class="keyword">write</span>( luloop, <span class="stringliteral">&#39;(a)&#39;</span> ) &amp;
<a name="l00699"></a>00699   &amp;   <span class="stringliteral">&#39;      if ( endtag .and. noattribs == 0 ) then&#39;</span>   ,&amp;
<a name="l00700"></a>00700   &amp;   <span class="stringliteral">&#39;         if ( xml_ok(info) ) then&#39;</span>                 ,&amp;
<a name="l00701"></a>00701   &amp;   <span class="stringliteral">&#39;            cycle&#39;</span>                                 ,&amp;
<a name="l00702"></a>00702   &amp;   <span class="stringliteral">&#39;         else&#39;</span>                                     ,&amp;
<a name="l00703"></a>00703   &amp;   <span class="stringliteral">&#39;            exit&#39;</span>                                  ,&amp;
<a name="l00704"></a>00704   &amp;   <span class="stringliteral">&#39;         endif&#39;</span>                                    ,&amp;
<a name="l00705"></a>00705   &amp;   <span class="stringliteral">&#39;      endif&#39;</span>                                       ,&amp;
<a name="l00706"></a>00706   &amp;   <span class="stringliteral">&#39;      select case( tag )&#39;</span>
<a name="l00707"></a>00707 <span class="keyword">end subroutine add_begin_loop</span>
<a name="l00708"></a>00708 
<a name="l00709"></a>00709 <span class="comment">!===============================================================================</span>
<a name="l00710"></a>00710 <span class="comment">! ADD_END_LOOP --</span>
<a name="l00711"></a>00711 <span class="comment">!    Routine to write the end of the reading loop</span>
<a name="l00712"></a>00712 <span class="comment">! Arguments:</span>
<a name="l00713"></a>00713 <span class="comment">!    None</span>
<a name="l00714"></a>00714 <span class="comment">!===============================================================================</span>
<a name="l00715"></a>00715 
<a name="l00716"></a><a class="code" href="xmlreader_8f90.html#abc8f04613aa2829685f5c907e6443153">00716</a> <span class="keyword">subroutine </span><a class="code" href="xmlreader_8f90.html#abc8f04613aa2829685f5c907e6443153">add_end_loop</a>
<a name="l00717"></a>00717 
<a name="l00718"></a>00718    <span class="keyword">write</span>( luend, <span class="stringliteral">&#39;(a)&#39;</span> ) &amp;
<a name="l00719"></a>00719   &amp;   <span class="stringliteral">&#39;      case (&#39;</span><span class="stringliteral">&#39;comment&#39;</span><span class="stringliteral">&#39;, &#39;</span><span class="stringliteral">&#39;!--&#39;</span><span class="stringliteral">&#39;)&#39;</span> ,&amp;
<a name="l00720"></a>00720   &amp;   <span class="stringliteral">&#39;         ! Simply ignore&#39;</span>, &amp;
<a name="l00721"></a>00721   &amp;   <span class="stringliteral">&#39;      case default&#39;</span> ,&amp;
<a name="l00722"></a>00722   &amp;   <span class="stringliteral">&#39;         if ( strict_ ) then&#39;</span>, &amp;
<a name="l00723"></a>00723   &amp;   <span class="stringliteral">&#39;            error = .true.&#39;</span>, &amp;
<a name="l00724"></a>00724   &amp;   <span class="stringliteral">&#39;            call xml_report_errors( info, &amp;&#39;</span>, &amp;
<a name="l00725"></a>00725   &amp;   <span class="stringliteral">&#39;               &#39;</span><span class="stringliteral">&#39;Unknown or wrongly placed tag: &#39;</span><span class="stringliteral">&#39; // trim(tag))&#39;</span>,&amp;
<a name="l00726"></a>00726   &amp;   <span class="stringliteral">&#39;         endif&#39;</span>
<a name="l00727"></a>00727 
<a name="l00728"></a>00728    <span class="keyword">write</span>( luend, <span class="stringliteral">&#39;(a)&#39;</span> ) &amp;
<a name="l00729"></a>00729   &amp;   <span class="stringliteral">&#39;      end select&#39;</span> ,&amp;
<a name="l00730"></a>00730   &amp;   <span class="stringliteral">&#39;      nodata = 0&#39;</span> ,&amp;
<a name="l00731"></a>00731   &amp;   <span class="stringliteral">&#39;      if ( .not. xml_ok(info) ) exit&#39;</span> , &amp;
<a name="l00732"></a>00732   &amp;   <span class="stringliteral">&#39;   end do&#39;</span>
<a name="l00733"></a>00733 <span class="keyword">end subroutine add_end_loop</span>
<a name="l00734"></a>00734 
<a name="l00735"></a>00735 <span class="comment">!===============================================================================</span>
<a name="l00736"></a>00736 <span class="comment">! ADD_VARIABLE --</span>
<a name="l00737"></a>00737 <span class="comment">!    Routine to write the definition of variables or components of</span>
<a name="l00738"></a>00738 <span class="comment">!    derived types</span>
<a name="l00739"></a>00739 <span class="comment">! Arguments:</span>
<a name="l00740"></a>00740 <span class="comment">!    component       Whether this is an ordinary variable or a component</span>
<a name="l00741"></a>00741 <span class="comment">!                    in a derived type</span>
<a name="l00742"></a>00742 <span class="comment">!===============================================================================</span>
<a name="l00743"></a>00743 
<a name="l00744"></a><a class="code" href="xmlreader_8f90.html#afef67cabfe69dc511d8fe06ef921a51d">00744</a> <span class="keyword">subroutine </span><a class="code" href="xmlreader_8f90.html#afef67cabfe69dc511d8fe06ef921a51d">add_variable</a>( component )
<a name="l00745"></a>00745    <span class="keywordtype">logical</span>                                :: component
<a name="l00746"></a>00746 
<a name="l00747"></a>00747    <span class="keywordtype">integer</span>                                :: idx1
<a name="l00748"></a>00748    <span class="keywordtype">integer</span>                                :: idx2
<a name="l00749"></a>00749    <span class="keywordtype">integer</span>                                :: idx3
<a name="l00750"></a>00750    <span class="keywordtype">integer</span>                                :: idx4
<a name="l00751"></a>00751    <span class="keywordtype">integer</span>                                :: idx5
<a name="l00752"></a>00752    <span class="keywordtype">integer</span>                                :: idx6
<a name="l00753"></a>00753    <span class="keywordtype">integer</span>                                :: idx7
<a name="l00754"></a>00754    <span class="keywordtype">integer</span>                                :: k
<a name="l00755"></a>00755    <span class="keywordtype">integer</span>                                :: vdim
<a name="l00756"></a>00756 
<a name="l00757"></a>00757    <span class="keywordtype">character(len=32)</span>                      :: varname
<a name="l00758"></a>00758    <span class="keywordtype">character(len=40)</span>                      :: varcomp
<a name="l00759"></a>00759    <span class="keywordtype">character(len=40)</span>                      :: varshape
<a name="l00760"></a>00760    <span class="keywordtype">character(len=100)</span>                     :: vardefault
<a name="l00761"></a>00761    <span class="keywordtype">character(len=32)</span>                      :: vartype
<a name="l00762"></a>00762    <span class="keywordtype">character(len=32)</span>                      :: vartag
<a name="l00763"></a>00763    <span class="keywordtype">character(len=10)</span>                      :: dim
<a name="l00764"></a>00764    <span class="keywordtype">character(len=10)</span>                      :: strlength
<a name="l00765"></a>00765    <span class="keywordtype">character(len=32)</span>                      :: initptr
<a name="l00766"></a>00766 
<a name="l00767"></a>00767    idx1 = <a class="code" href="namespacexmlparse.html#ac197863b0c6820b348aeb8cc46e08255">xml_find_attrib</a>( attribs, noattribs, <span class="stringliteral">&#39;name&#39;</span>, varname )
<a name="l00768"></a>00768    idx2 = <a class="code" href="namespacexmlparse.html#ac197863b0c6820b348aeb8cc46e08255">xml_find_attrib</a>( attribs, noattribs, <span class="stringliteral">&#39;type&#39;</span>, vartype )
<a name="l00769"></a>00769    strlength = <span class="stringliteral">&quot;--&quot;</span>
<a name="l00770"></a>00770    idx5 = <a class="code" href="namespacexmlparse.html#ac197863b0c6820b348aeb8cc46e08255">xml_find_attrib</a>( attribs, noattribs, <span class="stringliteral">&#39;length&#39;</span>, strlength )
<a name="l00771"></a>00771    <span class="keyword">if</span> ( idx1 &lt;= 0 ) <span class="keyword">then</span>
<a name="l00772"></a>00772       <span class="keyword">write</span>( 20, * ) <span class="stringliteral">&#39;Variable/component found which has no name&#39;</span>
<a name="l00773"></a>00773       error = .true.
<a name="l00774"></a>00774    <span class="keyword">endif</span>
<a name="l00775"></a>00775    <span class="keyword">if</span> ( idx2 &lt;= 0 ) <span class="keyword">then</span>
<a name="l00776"></a>00776       <span class="keyword">write</span>( 20, * ) <span class="stringliteral">&#39;Variable/component found which has no type - &#39;</span>,trim(varname)
<a name="l00777"></a>00777       error = .true.
<a name="l00778"></a>00778    <span class="keyword">else</span>
<a name="l00779"></a>00779       dim  = <span class="stringliteral">&#39;--&#39;</span>
<a name="l00780"></a>00780       idx7 = <a class="code" href="namespacexmlparse.html#ac197863b0c6820b348aeb8cc46e08255">xml_find_attrib</a>( attribs, noattribs, <span class="stringliteral">&#39;dimension&#39;</span>, dim )
<a name="l00781"></a>00781       idx6 = <a class="code" href="namespacexmlparse.html#ac197863b0c6820b348aeb8cc46e08255">xml_find_attrib</a>( attribs, noattribs, <span class="stringliteral">&#39;shape&#39;</span>, varshape )
<a name="l00782"></a>00782       <span class="keyword">if</span> ( idx7 &gt;= 1 ) <span class="keyword">then</span>
<a name="l00783"></a>00783          <span class="keyword">if</span> ( dim == <span class="stringliteral">&#39;1&#39;</span> ) <span class="keyword">then</span>
<a name="l00784"></a>00784             idx3 = <a class="code" href="namespacexmlparse.html#ac197863b0c6820b348aeb8cc46e08255">xml_find_attrib</a>( types, notypes, vartype, declare )
<a name="l00785"></a>00785             <span class="keyword">if</span> ( idx3 &gt; notypes_predefined ) <span class="keyword">then</span>
<a name="l00786"></a>00786                vartype = trim(vartype) // <span class="stringliteral">&#39;-array&#39;</span>
<a name="l00787"></a>00787             <span class="keyword">else</span>
<a name="l00788"></a>00788                vartype = trim(vartype) // <span class="stringliteral">&#39;-1dim&#39;</span>
<a name="l00789"></a>00789             <span class="keyword">endif</span>
<a name="l00790"></a>00790          <span class="keyword">else</span>
<a name="l00791"></a>00791             error = .true.
<a name="l00792"></a>00792             <span class="keyword">write</span>(20,*) <span class="stringliteral">&#39;Dimension not supported: &#39;</span>,dim
<a name="l00793"></a>00793          <span class="keyword">endif</span>
<a name="l00794"></a>00794       <span class="keyword">endif</span>
<a name="l00795"></a>00795       <span class="keyword">if</span> ( idx6 &gt;= 1 ) <span class="keyword">then</span>
<a name="l00796"></a>00796          vartype = trim(vartype) // <span class="stringliteral">&#39;-shape&#39;</span>
<a name="l00797"></a>00797          vdim    = 1
<a name="l00798"></a>00798          <span class="keyword">if</span> ( index(varshape, <span class="stringliteral">&#39;,&#39;</span>) &gt; 0 ) <span class="keyword">then</span>
<a name="l00799"></a>00799              vdim = 2
<a name="l00800"></a>00800          <span class="keyword">endif</span>
<a name="l00801"></a>00801       <span class="keyword">endif</span>
<a name="l00802"></a>00802 
<a name="l00803"></a>00803       idx3 = <a class="code" href="namespacexmlparse.html#ac197863b0c6820b348aeb8cc46e08255">xml_find_attrib</a>( types, notypes, vartype, declare )
<a name="l00804"></a>00804       <span class="keyword">if</span> ( idx3 &lt;= 0 ) <span class="keyword">then</span>
<a name="l00805"></a>00805          <span class="keyword">write</span>( 20, * ) &amp;
<a name="l00806"></a>00806             <span class="stringliteral">&#39;Variable/component with unknown type - &#39;</span>,trim(varname)
<a name="l00807"></a>00807          error = .true.
<a name="l00808"></a>00808       <span class="keyword">endif</span>
<a name="l00809"></a>00809    <span class="keyword">endif</span>
<a name="l00810"></a>00810 
<a name="l00811"></a>00811    idx4 = <a class="code" href="namespacexmlparse.html#ac197863b0c6820b348aeb8cc46e08255">xml_find_attrib</a>( attribs, noattribs, <span class="stringliteral">&#39;default&#39;</span>, vardefault )
<a name="l00812"></a>00812 
<a name="l00813"></a>00813    <span class="keyword">if</span> ( component ) <span class="keyword">then</span>
<a name="l00814"></a>00814       varcomp = <span class="stringliteral">&#39;dvar%&#39;</span>//varname
<a name="l00815"></a>00815    <span class="keyword">else</span>
<a name="l00816"></a>00816       varcomp = varname
<a name="l00817"></a>00817    <span class="keyword">endif</span>
<a name="l00818"></a>00818 
<a name="l00819"></a>00819    idx1 = <a class="code" href="namespacexmlparse.html#ac197863b0c6820b348aeb8cc46e08255">xml_find_attrib</a>( attribs, noattribs, <span class="stringliteral">&#39;tag&#39;</span>, vartag )
<a name="l00820"></a>00820    <span class="keyword">if</span> ( idx1 &lt; 1 ) <span class="keyword">then</span>
<a name="l00821"></a>00821       vartag = varname
<a name="l00822"></a>00822    <span class="keyword">endif</span>
<a name="l00823"></a>00823 
<a name="l00824"></a>00824    <span class="keyword">if</span> ( .not. error ) <span class="keyword">then</span>
<a name="l00825"></a>00825       <span class="keyword">if</span> ( index( declare, <span class="stringliteral">&quot;pointer&quot;</span> ) &gt; 0 ) <span class="keyword">then</span>
<a name="l00826"></a>00826          initptr = <span class="stringliteral">&quot; =&gt; null()&quot;</span>
<a name="l00827"></a>00827       <span class="keyword">else</span>
<a name="l00828"></a>00828          initptr = <span class="stringliteral">&quot;&quot;</span>
<a name="l00829"></a>00829       <span class="keyword">endif</span>
<a name="l00830"></a>00830 
<a name="l00831"></a>00831       k = index( declare, <span class="stringliteral">&#39;SHAPE&#39;</span> )
<a name="l00832"></a>00832       <span class="keyword">if</span> ( k &gt; 0 ) <span class="keyword">then</span>
<a name="l00833"></a>00833           declare = declare(1:k-1) // trim(varshape) // declare(k+5:)
<a name="l00834"></a>00834       <span class="keyword">endif</span>
<a name="l00835"></a>00835 
<a name="l00836"></a>00836       <span class="keyword">if</span> ( index( declare, <span class="stringliteral">&quot;?&quot;</span> ) &lt;= 0 ) <span class="keyword">then</span>
<a name="l00837"></a>00837          <span class="keyword">write</span>( ludef,    <span class="stringliteral">&#39;(4a)&#39;</span> ) declare,    <span class="stringliteral">&#39; :: &#39;</span>, trim(varname), trim(initptr)
<a name="l00838"></a>00838       <span class="keyword">else</span>
<a name="l00839"></a>00839          <span class="keyword">if</span> ( strlength == <span class="stringliteral">&quot;--&quot;</span> ) <span class="keyword">then</span>
<a name="l00840"></a>00840              strlength = <span class="stringliteral">&quot;1&quot;</span> <span class="comment">! Hm, error is better?</span>
<a name="l00841"></a>00841          <span class="keyword">endif</span>
<a name="l00842"></a>00842          idx5 = index( declare, <span class="stringliteral">&quot;?&quot;</span> )
<a name="l00843"></a>00843          <span class="keyword">write</span>( ludef,    <span class="stringliteral">&#39;(6a)&#39;</span> ) declare(1:idx5-1), trim(strlength), declare(idx5+1:), &amp;
<a name="l00844"></a>00844             <span class="stringliteral">&#39; :: &#39;</span>, trim(varname), trim(initptr)
<a name="l00845"></a>00845       <span class="keyword">endif</span>
<a name="l00846"></a>00846 
<a name="l00847"></a>00847       <span class="keyword">if</span> ( idx6 &gt; 0 ) <span class="keyword">then</span>
<a name="l00848"></a>00848          k = index( types(2,idx3-1), <span class="stringliteral">&#39;?&#39;</span> )
<a name="l00849"></a>00849          <span class="keyword">if</span> ( k &lt;= 0 ) <span class="keyword">then</span>
<a name="l00850"></a>00850             <span class="keyword">write</span>( luprolog, <span class="stringliteral">&#39;(3a)&#39;</span> ) types(2,idx3-1), <span class="stringliteral">&#39; :: &#39;</span>, <span class="stringliteral">&#39;p_&#39;</span>//trim(varname)
<a name="l00851"></a>00851          <span class="keyword">else</span>
<a name="l00852"></a>00852             <span class="keyword">write</span>( luprolog, <span class="stringliteral">&#39;(6a)&#39;</span> ) types(2,idx3-1)(1:k-1), trim(strlength), &amp;
<a name="l00853"></a>00853                types(2,idx3-1)(k+1:), <span class="stringliteral">&#39; :: &#39;</span>, <span class="stringliteral">&#39;p_&#39;</span>//trim(varname)
<a name="l00854"></a>00854          <span class="keyword">endif</span>
<a name="l00855"></a>00855       <span class="keyword">endif</span>
<a name="l00856"></a>00856       <span class="keyword">write</span>( luprolog, <span class="stringliteral">&#39;(3a)&#39;</span> ) types(2,1), <span class="stringliteral">&#39; :: &#39;</span>, <span class="stringliteral">&#39;has_&#39;</span>//trim(varname)
<a name="l00857"></a>00857       <span class="keyword">write</span>( lustart,  <span class="stringliteral">&#39;(3a)&#39;</span> ) <span class="stringliteral">&#39;   has_&#39;</span>, varname, <span class="stringliteral">&#39; = .false.&#39;</span>
<a name="l00858"></a>00858       <span class="keyword">if</span> ( dim /= <span class="stringliteral">&#39;--&#39;</span> ) <span class="keyword">then</span>
<a name="l00859"></a>00859          <span class="keyword">write</span>( lustart,  <span class="stringliteral">&#39;(3a)&#39;</span> ) <span class="stringliteral">&#39;   allocate(&#39;</span> // trim(varcomp), <span class="stringliteral">&#39;(0))&#39;</span>
<a name="l00860"></a>00860       <span class="keyword">endif</span>
<a name="l00861"></a>00861       <span class="keyword">write</span>( luloop,   <span class="stringliteral">&#39;(a)&#39;</span> ) <span class="stringliteral">&#39;      case(&#39;</span><span class="stringliteral">&#39;&#39;</span>//trim(vartag)//<span class="stringliteral">&#39;&#39;</span><span class="stringliteral">&#39;)&#39;</span>
<a name="l00862"></a>00862 
<a name="l00863"></a>00863       <span class="keyword">if</span> ( idx6 &lt;= 0 ) <span class="keyword">then</span>
<a name="l00864"></a>00864          <span class="keyword">write</span>( luloop,   <span class="stringliteral">&#39;(a)&#39;</span> ) &amp;
<a name="l00865"></a>00865             &amp;<span class="stringliteral">&#39;         call &#39;</span>//trim(types(3,idx3))//<span class="stringliteral">&#39;( &amp;&#39;</span>, &amp;
<a name="l00866"></a>00866             &amp;<span class="stringliteral">&#39;            info, tag, endtag, attribs, noattribs, data, nodata, &amp;&#39;</span>,&amp;
<a name="l00867"></a>00867             &amp;<span class="stringliteral">&#39;            &#39;</span> // trim(varcomp) // <span class="stringliteral">&#39;, has_&#39;</span>//trim(varname) // <span class="stringliteral">&#39; )&#39;</span>
<a name="l00868"></a>00868       <span class="keyword">else</span>
<a name="l00869"></a>00869          <span class="keyword">write</span>( luloop,   <span class="stringliteral">&#39;(a)&#39;</span> ) &amp;
<a name="l00870"></a>00870             &amp;<span class="stringliteral">&#39;         call &#39;</span>//trim(types(3,idx3))//<span class="stringliteral">&#39;( &amp;&#39;</span>, &amp;
<a name="l00871"></a>00871             &amp;<span class="stringliteral">&#39;            info, tag, endtag, attribs, noattribs, data, nodata, &amp;&#39;</span>,&amp;
<a name="l00872"></a>00872             &amp;<span class="stringliteral">&#39;            p_&#39;</span> // trim(varname) // <span class="stringliteral">&#39;, has_&#39;</span>//trim(varname) // <span class="stringliteral">&#39; )&#39;</span>,&amp;
<a name="l00873"></a>00873             &amp;<span class="stringliteral">&#39;         if ( has_&#39;</span>//trim(varname) // <span class="stringliteral">&#39;) then&#39;</span>
<a name="l00874"></a>00874          <span class="keyword">if</span> ( vdim == 1 ) <span class="keyword">then</span>
<a name="l00875"></a>00875              <span class="keyword">write</span>( luloop,   <span class="stringliteral">&#39;(a)&#39;</span> ) &amp;
<a name="l00876"></a>00876             &amp;<span class="stringliteral">&#39;            if ( size(&#39;</span>//trim(varcomp)//<span class="stringliteral">&#39;) &lt;= size(p_&#39;</span>//trim(varname)//<span class="stringliteral">&#39;) ) then&#39;</span>, &amp;
<a name="l00877"></a>00877             &amp;<span class="stringliteral">&#39;               &#39;</span>//trim(varcomp) // <span class="stringliteral">&#39; = p_&#39;</span>//trim(varname)//<span class="stringliteral">&#39;(1:size(&#39;</span>//trim(varcomp)//<span class="stringliteral">&#39;))&#39;</span>, &amp;
<a name="l00878"></a>00878             &amp;<span class="stringliteral">&#39;            else&#39;</span>, &amp;
<a name="l00879"></a>00879             &amp;<span class="stringliteral">&#39;               &#39;</span>//trim(varcomp) // <span class="stringliteral">&#39;(1:size(p_&#39;</span>//trim(varname)//<span class="stringliteral">&#39;)) = p_&#39;</span>//trim(varname), &amp;
<a name="l00880"></a>00880             &amp;<span class="stringliteral">&#39;            endif&#39;</span>
<a name="l00881"></a>00881          <span class="keyword">else</span>
<a name="l00882"></a>00882              <span class="keyword">write</span>( luloop,   <span class="stringliteral">&#39;(a)&#39;</span> ) &amp;
<a name="l00883"></a>00883             &amp;<span class="stringliteral">&#39;            if ( size(p_&#39;</span>//trim(varname)//<span class="stringliteral">&#39;) &gt;= size(&#39;</span>//trim(varcomp)//<span class="stringliteral">&#39;) ) then&#39;</span>,&amp;
<a name="l00884"></a>00884             &amp;<span class="stringliteral">&#39;               &#39;</span>//trim(varcomp)//<span class="stringliteral">&#39; = reshape(p_&#39;</span>//trim(varname)//<span class="stringliteral">&#39;, shape(&#39;</span>//trim(varcomp)//<span class="stringliteral">&#39;))&#39;</span>,&amp;
<a name="l00885"></a>00885             &amp;<span class="stringliteral">&#39;            else&#39;</span>,&amp;
<a name="l00886"></a>00886             &amp;<span class="stringliteral">&#39;               has_&#39;</span>//trim(varname)//<span class="stringliteral">&#39; = .false.&#39;</span>,&amp;
<a name="l00887"></a>00887             &amp;<span class="stringliteral">&#39;               call xml_report_errors(info, &#39;</span><span class="stringliteral">&#39;Incorrect number of values for &#39;</span>//trim(varname)//<span class="stringliteral">&#39;&#39;</span><span class="stringliteral">&#39;)&#39;</span>, &amp;
<a name="l00888"></a>00888             &amp;<span class="stringliteral">&#39;            endif&#39;</span>
<a name="l00889"></a>00889          <span class="keyword">endif</span>
<a name="l00890"></a>00890          <span class="keyword">write</span>( luloop,   <span class="stringliteral">&#39;(a)&#39;</span> ) &amp;
<a name="l00891"></a>00891             &amp;<span class="stringliteral">&#39;            deallocate( p_&#39;</span>//trim(varname)//<span class="stringliteral">&#39; )&#39;</span>, &amp;
<a name="l00892"></a>00892             &amp;<span class="stringliteral">&#39;         endif&#39;</span>
<a name="l00893"></a>00893       <span class="keyword">endif</span>
<a name="l00894"></a>00894       <span class="keyword">if</span> ( idx4 &lt;= 0 ) <span class="keyword">then</span>
<a name="l00895"></a>00895          <span class="keyword">write</span>( luend,    <span class="stringliteral">&#39;(a)&#39;</span> ) &amp;
<a name="l00896"></a>00896          &amp;<span class="stringliteral">&#39;   if ( .not. has_&#39;</span>//trim(varname)//<span class="stringliteral">&#39; ) then&#39;</span>
<a name="l00897"></a>00897 
<a name="l00898"></a>00898          <span class="keyword">if</span> ( component ) <span class="keyword">then</span>
<a name="l00899"></a>00899             <span class="keyword">write</span>( luend,    <span class="stringliteral">&#39;(a)&#39;</span> ) &amp;
<a name="l00900"></a>00900          &amp;<span class="stringliteral">&#39;      has_dvar = .false.&#39;</span>
<a name="l00901"></a>00901          <span class="keyword">else</span>
<a name="l00902"></a>00902             <span class="keyword">write</span>( luend,    <span class="stringliteral">&#39;(a)&#39;</span> ) &amp;
<a name="l00903"></a>00903          &amp;<span class="stringliteral">&#39;      error = .true.&#39;</span>
<a name="l00904"></a>00904          <span class="keyword">endif</span>
<a name="l00905"></a>00905 
<a name="l00906"></a>00906          <span class="keyword">write</span>( luend,    <span class="stringliteral">&#39;(a)&#39;</span> ) &amp;
<a name="l00907"></a>00907          &amp;<span class="stringliteral">&#39;      call xml_report_errors(info, &#39;</span><span class="stringliteral">&#39;Missing data on &#39;</span>//trim(varname)//<span class="stringliteral">&#39;&#39;</span><span class="stringliteral">&#39;)&#39;</span>, &amp;
<a name="l00908"></a>00908          &amp;<span class="stringliteral">&#39;   endif&#39;</span>
<a name="l00909"></a>00909       <span class="keyword">else</span>
<a name="l00910"></a>00910          <span class="comment">!</span>
<a name="l00911"></a>00911          <span class="comment">! Note: the attribute value is supposed to have the quotes, if that</span>
<a name="l00912"></a>00912          <span class="comment">! is relevant for the variable&#39;s type</span>
<a name="l00913"></a>00913          <span class="comment">!</span>
<a name="l00914"></a>00914          <span class="keyword">if</span> ( component ) <span class="keyword">then</span>
<a name="l00915"></a>00915             <span class="keyword">write</span>( ludeflt,    <span class="stringliteral">&#39;(4a)&#39;</span> ) &amp;
<a name="l00916"></a>00916             &amp;<span class="stringliteral">&#39;   dvar%&#39;</span>, trim(varname), <span class="stringliteral">&#39; = &#39;</span>, attribs(2,idx4)
<a name="l00917"></a>00917          <span class="keyword">else</span>
<a name="l00918"></a>00918             <span class="keyword">write</span>( luinit,   <span class="stringliteral">&#39;(4a)&#39;</span> ) &amp;
<a name="l00919"></a>00919             &amp;<span class="stringliteral">&#39;   &#39;</span>, trim(varname), <span class="stringliteral">&#39; = &#39;</span>, attribs(2,idx4)
<a name="l00920"></a>00920          <span class="keyword">endif</span>
<a name="l00921"></a>00921       <span class="keyword">endif</span>
<a name="l00922"></a>00922       <span class="comment">!</span>
<a name="l00923"></a>00923       <span class="comment">! Write the component/variable</span>
<a name="l00924"></a>00924       <span class="comment">!</span>
<a name="l00925"></a>00925       <span class="keyword">if</span> ( component ) <span class="keyword">then</span>
<a name="l00926"></a>00926          <span class="keyword">write</span>( luwrite,   <span class="stringliteral">&#39;(4a)&#39;</span> ) &amp;
<a name="l00927"></a>00927          &amp;<span class="stringliteral">&#39;   call &#39;</span>//trim(types(4,idx3))//<span class="stringliteral">&#39;(&#39;</span>, &amp;
<a name="l00928"></a>00928          &amp;<span class="stringliteral">&#39; info, &#39;</span><span class="stringliteral">&#39;&#39;</span>//trim(vartag)//<span class="stringliteral">&#39;&#39;</span><span class="stringliteral">&#39;, indent+3, dvar%&#39;</span>, trim(varname), <span class="stringliteral">&#39;)&#39;</span>
<a name="l00929"></a>00929       <span class="keyword">else</span>
<a name="l00930"></a>00930          <span class="keyword">write</span>( luwrv,   <span class="stringliteral">&#39;(4a)&#39;</span> ) &amp;
<a name="l00931"></a>00931          &amp;<span class="stringliteral">&#39;   call &#39;</span>//trim(types(4,idx3))//<span class="stringliteral">&#39;(&#39;</span>, &amp;
<a name="l00932"></a>00932          &amp;<span class="stringliteral">&#39; info, &#39;</span><span class="stringliteral">&#39;&#39;</span>//trim(vartag)//<span class="stringliteral">&#39;&#39;</span><span class="stringliteral">&#39;, indent+3, &#39;</span>, trim(varname), <span class="stringliteral">&#39;)&#39;</span>
<a name="l00933"></a>00933       <span class="keyword">endif</span>
<a name="l00934"></a>00934    <span class="keyword">endif</span>
<a name="l00935"></a>00935 
<a name="l00936"></a>00936 <span class="keyword">end subroutine add_variable</span>
<a name="l00937"></a>00937 
<a name="l00938"></a>00938 <span class="comment">!===============================================================================</span>
<a name="l00939"></a>00939 <span class="comment">! ADD_TYPEDEF --</span>
<a name="l00940"></a>00940 <span class="comment">!    Routine to write the definition and other code for a derived type</span>
<a name="l00941"></a>00941 <span class="comment">! Arguments:</span>
<a name="l00942"></a>00942 <span class="comment">!    dyn_strings     Whether dynamic string lengths are allowed</span>
<a name="l00943"></a>00943 <span class="comment">!===============================================================================</span>
<a name="l00944"></a>00944 
<a name="l00945"></a><a class="code" href="xmlreader_8f90.html#aa47d469919b171944994a78b3e9ac048">00945</a> <span class="keyword">subroutine </span><a class="code" href="xmlreader_8f90.html#aa47d469919b171944994a78b3e9ac048">add_typedef</a>( dyn_strings )
<a name="l00946"></a>00946    <span class="keywordtype">logical</span>, <span class="keywordtype">intent(in)</span>                    :: dyn_strings
<a name="l00947"></a>00947 
<a name="l00948"></a>00948    <span class="keywordtype">integer</span>                                :: idx1
<a name="l00949"></a>00949    <span class="keywordtype">integer</span>                                :: idx2
<a name="l00950"></a>00950 
<a name="l00951"></a>00951    <span class="keywordtype">character(len=32)</span>                      :: typetag
<a name="l00952"></a>00952 
<a name="l00953"></a>00953    idx1 = <a class="code" href="namespacexmlparse.html#ac197863b0c6820b348aeb8cc46e08255">xml_find_attrib</a>( attribs, noattribs, <span class="stringliteral">&#39;name&#39;</span>, typename )
<a name="l00954"></a>00954    <span class="keyword">if</span> ( idx1 &lt;= 0 ) <span class="keyword">then</span>
<a name="l00955"></a>00955       <span class="keyword">write</span>( 20, * ) <span class="stringliteral">&#39;Type definition found which has no name&#39;</span>
<a name="l00956"></a>00956       error = .true.
<a name="l00957"></a>00957    <span class="keyword">endif</span>
<a name="l00958"></a>00958 
<a name="l00959"></a>00959    <span class="comment">!</span>
<a name="l00960"></a>00960    <span class="comment">! We need a new set of temporary files</span>
<a name="l00961"></a>00961    <span class="comment">!</span>
<a name="l00962"></a>00962    call <a class="code" href="xmlreader_8f90.html#a0d4c0b96aed4f686ec75542ed9c8c01e">open_tmp_files</a>( luprolog+notmps )
<a name="l00963"></a>00963 
<a name="l00964"></a>00964    idx2 = <a class="code" href="namespacexmlparse.html#ac197863b0c6820b348aeb8cc46e08255">xml_find_attrib</a>( attribs, noattribs, <span class="stringliteral">&#39;tag&#39;</span>, typetag )
<a name="l00965"></a>00965    <span class="keyword">if</span> ( idx1 &lt; 1 ) <span class="keyword">then</span>
<a name="l00966"></a>00966       typetag = typename
<a name="l00967"></a>00967    <span class="keyword">endif</span>
<a name="l00968"></a>00968 
<a name="l00969"></a>00969    <span class="keyword">if</span> ( .not. error ) <span class="keyword">then</span>
<a name="l00970"></a>00970       <span class="keyword">write</span>( ludef,    <span class="stringliteral">&#39;(/,2a)&#39;</span> ) <span class="stringliteral">&#39;type &#39;</span>,trim(typename)
<a name="l00971"></a>00971       <span class="keyword">write</span>( luprolog, <span class="stringliteral">&#39;(a)&#39;</span> ) &amp;
<a name="l00972"></a>00972   &amp;   <span class="stringliteral">&#39;subroutine read_xml_type_&#39;</span>//trim(typename)//<span class="stringliteral">&#39;_array( &amp;&#39;</span>      ,&amp;
<a name="l00973"></a>00973   &amp;   <span class="stringliteral">&#39;      info, tag, endtag, attribs, noattribs, data, nodata, &amp;&#39;</span>,&amp;
<a name="l00974"></a>00974   &amp;   <span class="stringliteral">&#39;      dvar, has_dvar )&#39;</span>                                      ,&amp;
<a name="l00975"></a>00975   &amp;   <span class="stringliteral">&#39;   type(XML_PARSE)                                 :: info&#39;</span>  ,&amp;
<a name="l00976"></a>00976   &amp;   <span class="stringliteral">&#39;   character(len=*), intent(inout)                 :: tag    &#39;</span>,&amp;
<a name="l00977"></a>00977   &amp;   <span class="stringliteral">&#39;   logical, intent(inout)                          :: endtag &#39;</span>,&amp;
<a name="l00978"></a>00978   &amp;   <span class="stringliteral">&#39;   character(len=*), dimension(:,:), intent(inout) :: attribs&#39;</span>,&amp;
<a name="l00979"></a>00979   &amp;   <span class="stringliteral">&#39;   integer, intent(inout)                          :: noattribs&#39;</span>,&amp;
<a name="l00980"></a>00980   &amp;   <span class="stringliteral">&#39;   character(len=*), dimension(:), intent(inout)   :: data   &#39;</span>,&amp;
<a name="l00981"></a>00981   &amp;   <span class="stringliteral">&#39;   integer, intent(inout)                          :: nodata &#39;</span>,&amp;
<a name="l00982"></a>00982   &amp;   <span class="stringliteral">&#39;   type(&#39;</span>//trim(typename)//<span class="stringliteral">&#39;), dimension(:), pointer :: dvar &#39;</span>,&amp;
<a name="l00983"></a>00983   &amp;   <span class="stringliteral">&#39;   logical, intent(inout)                       :: has_dvar  &#39;</span>,&amp;
<a name="l00984"></a>00984   &amp;   <span class="stringliteral">&#39;   &#39;</span>                                                          ,&amp;
<a name="l00985"></a>00985   &amp;   <span class="stringliteral">&#39;   integer                                      :: newsize   &#39;</span>,&amp;
<a name="l00986"></a>00986   &amp;   <span class="stringliteral">&#39;   type(&#39;</span>//trim(typename)//<span class="stringliteral">&#39;), dimension(:), pointer :: newvar&#39;</span>,&amp;
<a name="l00987"></a>00987   &amp;   <span class="stringliteral">&#39;   &#39;</span>                                                          ,&amp;
<a name="l00988"></a>00988   &amp;   <span class="stringliteral">&#39;   newsize = size(dvar) + 1&#39;</span>                                  ,&amp;
<a name="l00989"></a>00989   &amp;   <span class="stringliteral">&#39;   allocate( newvar(1:newsize) )&#39;</span>                             ,&amp;
<a name="l00990"></a>00990   &amp;   <span class="stringliteral">&#39;   newvar(1:newsize-1) = dvar&#39;</span>                                ,&amp;
<a name="l00991"></a>00991   &amp;   <span class="stringliteral">&#39;   deallocate( dvar )&#39;</span>                                        ,&amp;
<a name="l00992"></a>00992   &amp;   <span class="stringliteral">&#39;   dvar =&gt; newvar&#39;</span>                                            ,&amp;
<a name="l00993"></a>00993   &amp;   <span class="stringliteral">&#39;   &#39;</span>                                                          ,&amp;
<a name="l00994"></a>00994   &amp;   <span class="stringliteral">&#39;   call read_xml_type_&#39;</span>//trim(typename)// &amp;
<a name="l00995"></a>00995   &amp;         <span class="stringliteral">&#39;( info, tag, endtag, attribs, noattribs, data, nodata, &amp;&#39;</span>,&amp;
<a name="l00996"></a>00996   &amp;   <span class="stringliteral">&#39;              dvar(newsize), has_dvar )&#39;</span>                      ,&amp;
<a name="l00997"></a>00997   &amp;   <span class="stringliteral">&#39;end subroutine read_xml_type_&#39;</span>//trim(typename)//<span class="stringliteral">&#39;_array&#39;</span>      ,&amp;
<a name="l00998"></a>00998   &amp;   <span class="stringliteral">&#39;   &#39;</span>
<a name="l00999"></a>00999 
<a name="l01000"></a>01000       <span class="keyword">write</span>( luwrite, <span class="stringliteral">&#39;(a)&#39;</span> ) &amp;
<a name="l01001"></a>01001   &amp;   <span class="stringliteral">&#39;subroutine write_xml_type_&#39;</span>//trim(typename)//<span class="stringliteral">&#39;_array( &amp;&#39;</span>     ,&amp;
<a name="l01002"></a>01002   &amp;   <span class="stringliteral">&#39;      info, tag, indent, dvar )&#39;</span>                             ,&amp;
<a name="l01003"></a>01003   &amp;   <span class="stringliteral">&#39;   type(XML_PARSE)                                 :: info&#39;</span>  ,&amp;
<a name="l01004"></a>01004   &amp;   <span class="stringliteral">&#39;   character(len=*), intent(in)                    :: tag&#39;</span>   ,&amp;
<a name="l01005"></a>01005   &amp;   <span class="stringliteral">&#39;   integer                                         :: indent&#39;</span>,&amp;
<a name="l01006"></a>01006   &amp;   <span class="stringliteral">&#39;   type(&#39;</span>//trim(typename)//<span class="stringliteral">&#39;), dimension(:)        :: dvar&#39;</span>  ,&amp;
<a name="l01007"></a>01007   &amp;   <span class="stringliteral">&#39;   integer                                         :: i&#39;</span>     ,&amp;
<a name="l01008"></a>01008   &amp;   <span class="stringliteral">&#39;   do i = 1,size(dvar)&#39;</span>                                      ,&amp;
<a name="l01009"></a>01009   &amp;   <span class="stringliteral">&#39;       call write_xml_type_&#39;</span>//trim(typename)// &amp;
<a name="l01010"></a>01010   &amp;              <span class="stringliteral">&#39;( info, tag, indent, dvar(i) )&#39;</span>                   ,&amp;
<a name="l01011"></a>01011   &amp;   <span class="stringliteral">&#39;   enddo&#39;</span>                                                    ,&amp;
<a name="l01012"></a>01012   &amp;   <span class="stringliteral">&#39;end subroutine write_xml_type_&#39;</span>//trim(typename)//<span class="stringliteral">&#39;_array&#39;</span>    ,&amp;
<a name="l01013"></a>01013   &amp;   <span class="stringliteral">&#39;   &#39;</span>, &amp;
<a name="l01014"></a>01014   &amp;   <span class="stringliteral">&#39;subroutine write_xml_type_&#39;</span>//trim(typename)//<span class="stringliteral">&#39;( &amp;&#39;</span>           ,&amp;
<a name="l01015"></a>01015   &amp;   <span class="stringliteral">&#39;      info, tag, indent, dvar )&#39;</span>                             ,&amp;
<a name="l01016"></a>01016   &amp;   <span class="stringliteral">&#39;   type(XML_PARSE)                                 :: info&#39;</span>  ,&amp;
<a name="l01017"></a>01017   &amp;   <span class="stringliteral">&#39;   character(len=*), intent(in)                    :: tag&#39;</span>   ,&amp;
<a name="l01018"></a>01018   &amp;   <span class="stringliteral">&#39;   integer                                         :: indent&#39;</span>,&amp;
<a name="l01019"></a>01019   &amp;   <span class="stringliteral">&#39;   type(&#39;</span>//trim(typename)//<span class="stringliteral">&#39;)                      :: dvar&#39;</span>  ,&amp;
<a name="l01020"></a>01020   &amp;   <span class="stringliteral">&#39;   character(len=100)                              :: indentation&#39;</span> ,&amp;
<a name="l01021"></a>01021   &amp;   <span class="stringliteral">&#39;   indentation = &#39;</span><span class="stringliteral">&#39; &#39;</span><span class="stringliteral">&#39;&#39;</span>                                      ,&amp;
<a name="l01022"></a>01022   &amp;   <span class="stringliteral">&#39;   write(info%lun, &#39;</span><span class="stringliteral">&#39;(4a)&#39;</span><span class="stringliteral">&#39; ) indentation(1:min(indent,100)),&amp;&#39;</span>,&amp;
<a name="l01023"></a>01023   &amp;   <span class="stringliteral">&#39;       &#39;</span><span class="stringliteral">&#39;&lt;&#39;</span><span class="stringliteral">&#39;,trim(tag), &#39;</span><span class="stringliteral">&#39;&gt;&#39;</span><span class="stringliteral">&#39;&#39;</span>
<a name="l01024"></a>01024 
<a name="l01025"></a>01025       <span class="keyword">write</span>( luprolog, <span class="stringliteral">&#39;(a)&#39;</span> ) &amp;
<a name="l01026"></a>01026   &amp;   <span class="stringliteral">&#39;subroutine read_xml_type_&#39;</span>//trim(typename)//&amp;
<a name="l01027"></a>01027   &amp;         <span class="stringliteral">&#39;( info, starttag, endtag, attribs, noattribs, data, nodata, &amp;&#39;</span> ,&amp;
<a name="l01028"></a>01028   &amp;   <span class="stringliteral">&#39;              dvar, has_dvar )&#39;</span>                              ,&amp;
<a name="l01029"></a>01029   &amp;   <span class="stringliteral">&#39;   type(XML_PARSE)                                 :: info&#39;</span>   ,&amp;
<a name="l01030"></a>01030   &amp;   <span class="stringliteral">&#39;   character(len=*), intent(in)                    :: starttag&#39;</span>,&amp;
<a name="l01031"></a>01031   &amp;   <span class="stringliteral">&#39;   logical, intent(inout)                          :: endtag  &#39;</span>,&amp;
<a name="l01032"></a>01032   &amp;   <span class="stringliteral">&#39;   character(len=*), dimension(:,:), intent(inout) :: attribs&#39;</span>,&amp;
<a name="l01033"></a>01033   &amp;   <span class="stringliteral">&#39;   integer, intent(inout)                          :: noattribs&#39;</span>,&amp;
<a name="l01034"></a>01034   &amp;   <span class="stringliteral">&#39;   character(len=*), dimension(:), intent(inout)   :: data   &#39;</span>,&amp;
<a name="l01035"></a>01035   &amp;   <span class="stringliteral">&#39;   integer, intent(inout)                          :: nodata &#39;</span>,&amp;
<a name="l01036"></a>01036   &amp;   <span class="stringliteral">&#39;   type(&#39;</span>//trim(typename)//<span class="stringliteral">&#39;), intent(inout)  :: dvar&#39;</span> ,&amp;
<a name="l01037"></a>01037   &amp;   <span class="stringliteral">&#39;   logical, intent(inout)                       :: has_dvar  &#39;</span>,&amp;
<a name="l01038"></a>01038   &amp;   <span class="stringliteral">&#39;   &#39;</span>                                                          ,&amp;
<a name="l01039"></a>01039   &amp;   <span class="stringliteral">&#39;   integer                                      :: att_      &#39;</span>,&amp;
<a name="l01040"></a>01040   &amp;   <span class="stringliteral">&#39;   integer                                      :: noatt_    &#39;</span>,&amp;
<a name="l01041"></a>01041   &amp;   <span class="stringliteral">&#39;   logical                                      :: error     &#39;</span>,&amp;
<a name="l01042"></a>01042   &amp;   <span class="stringliteral">&#39;   logical                                      :: endtag_org&#39;</span>
<a name="l01043"></a>01043       <span class="keyword">if</span> ( dyn_strings ) <span class="keyword">then</span>
<a name="l01044"></a>01044           <span class="keyword">write</span>( luprolog, <span class="stringliteral">&#39;(a)&#39;</span> ) &amp;
<a name="l01045"></a>01045   &amp;   <span class="stringliteral">&#39;   character(len=len(starttag))                 :: tag       &#39;</span>
<a name="l01046"></a>01046       <span class="keyword">else</span>
<a name="l01047"></a>01047           <span class="keyword">write</span>( luprolog, <span class="stringliteral">&#39;(a)&#39;</span> ) &amp;
<a name="l01048"></a>01048   &amp;   <span class="stringliteral">&#39;   character(len=80)                            :: tag       &#39;</span>
<a name="l01049"></a>01049       <span class="keyword">endif</span>
<a name="l01050"></a>01050 
<a name="l01051"></a>01051       <span class="comment">!</span>
<a name="l01052"></a>01052       <span class="comment">! Note: this may require a more sophisticated approach</span>
<a name="l01053"></a>01053       <span class="comment">! when the components of the type are also pointers ...</span>
<a name="l01054"></a>01054       <span class="comment">!</span>
<a name="l01055"></a>01055       <span class="keyword">write</span>( ludeflt, <span class="stringliteral">&#39;(a)&#39;</span> ) &amp;
<a name="l01056"></a>01056   &amp;   <span class="stringliteral">&#39;subroutine init_xml_type_&#39;</span>//trim(typename)//<span class="stringliteral">&#39;_array( dvar )  &#39;</span>,&amp;
<a name="l01057"></a>01057   &amp;   <span class="stringliteral">&#39;   type(&#39;</span>//trim(typename)//<span class="stringliteral">&#39;), dimension(:), pointer :: dvar &#39;</span>,&amp;
<a name="l01058"></a>01058   &amp;   <span class="stringliteral">&#39;   if ( associated( dvar ) ) then&#39;</span>                            ,&amp;
<a name="l01059"></a>01059   &amp;   <span class="stringliteral">&#39;      deallocate( dvar )&#39;</span>                                     ,&amp;
<a name="l01060"></a>01060   &amp;   <span class="stringliteral">&#39;   endif&#39;</span>                                                     ,&amp;
<a name="l01061"></a>01061   &amp;   <span class="stringliteral">&#39;   allocate( dvar(0) )&#39;</span>                                       ,&amp;
<a name="l01062"></a>01062   &amp;   <span class="stringliteral">&#39;end subroutine init_xml_type_&#39;</span>//trim(typename)//<span class="stringliteral">&#39;_array&#39;</span>      ,&amp;
<a name="l01063"></a>01063   &amp;   <span class="stringliteral">&#39;subroutine init_xml_type_&#39;</span>//trim(typename)//<span class="stringliteral">&#39;(dvar)&#39;</span>          ,&amp;
<a name="l01064"></a>01064   &amp;   <span class="stringliteral">&#39;   type(&#39;</span>//trim(typename)//<span class="stringliteral">&#39;) :: dvar &#39;</span>
<a name="l01065"></a>01065 
<a name="l01066"></a>01066       begin_loop = .true.
<a name="l01067"></a>01067 
<a name="l01068"></a>01068       call <a class="code" href="xmlreader_8f90.html#abc8f04613aa2829685f5c907e6443153">add_end_loop</a>
<a name="l01069"></a>01069 
<a name="l01070"></a>01070       <span class="comment">!</span>
<a name="l01071"></a>01071       <span class="comment">! Add the names of the two new types to the list</span>
<a name="l01072"></a>01072       <span class="comment">!</span>
<a name="l01073"></a>01073       <span class="keyword">allocate</span>( new_types(1:4,1:notypes+3) )
<a name="l01074"></a>01074       new_types(:,1:notypes) = types
<a name="l01075"></a>01075       <span class="keyword">deallocate</span>( types )
<a name="l01076"></a>01076       types =&gt; new_types
<a name="l01077"></a>01077 
<a name="l01078"></a>01078       types(1,notypes+1) = typename
<a name="l01079"></a>01079       types(2,notypes+1) = <span class="stringliteral">&#39;   type(&#39;</span>//trim(typename)//<span class="stringliteral">&#39;)&#39;</span>
<a name="l01080"></a>01080       types(3,notypes+1) = <span class="stringliteral">&#39;read_xml_type_&#39;</span>//trim(typename)
<a name="l01081"></a>01081       types(4,notypes+1) = <span class="stringliteral">&#39;write_xml_type_&#39;</span>//trim(typename)
<a name="l01082"></a>01082 
<a name="l01083"></a>01083       types(1,notypes+2) = trim(typename) // <span class="stringliteral">&#39;-array&#39;</span>
<a name="l01084"></a>01084       types(2,notypes+2) = <span class="stringliteral">&#39;   type(&#39;</span>//trim(typename)//<span class="stringliteral">&#39;), dimension(:), pointer&#39;</span>
<a name="l01085"></a>01085       types(3,notypes+2) = <span class="stringliteral">&#39;read_xml_type_&#39;</span>//trim(typename)//<span class="stringliteral">&#39;_array&#39;</span>
<a name="l01086"></a>01086       types(4,notypes+2) = <span class="stringliteral">&#39;write_xml_type_&#39;</span>//trim(typename)//<span class="stringliteral">&#39;_array&#39;</span>
<a name="l01087"></a>01087 
<a name="l01088"></a>01088       types(1,notypes+3) = trim(typename) // <span class="stringliteral">&#39;-shape&#39;</span>
<a name="l01089"></a>01089       types(2,notypes+3) = <span class="stringliteral">&#39;   type(&#39;</span>//trim(typename)//<span class="stringliteral">&#39;), dimension(SHAPE)&#39;</span>
<a name="l01090"></a>01090       types(3,notypes+3) = <span class="stringliteral">&#39;read_xml_type_&#39;</span>//trim(typename)//<span class="stringliteral">&#39;_array&#39;</span>
<a name="l01091"></a>01091       types(4,notypes+3) = <span class="stringliteral">&#39;write_xml_type_&#39;</span>//trim(typename)//<span class="stringliteral">&#39;_array&#39;</span>
<a name="l01092"></a>01092 
<a name="l01093"></a>01093       notypes = notypes + 3
<a name="l01094"></a>01094 
<a name="l01095"></a>01095    <span class="keyword">endif</span>
<a name="l01096"></a>01096 <span class="keyword">end subroutine add_typedef</span>
<a name="l01097"></a>01097 
<a name="l01098"></a>01098 <span class="comment">!===============================================================================</span>
<a name="l01099"></a>01099 <span class="comment">! CLOSE_TYPEDEF --</span>
<a name="l01100"></a>01100 <span class="comment">!    Routine to write the last code fragments for a derived type</span>
<a name="l01101"></a>01101 <span class="comment">! Arguments:</span>
<a name="l01102"></a>01102 <span class="comment">!    component       Turn off the &quot;component&quot; parameter</span>
<a name="l01103"></a>01103 <span class="comment">!===============================================================================</span>
<a name="l01104"></a>01104 
<a name="l01105"></a><a class="code" href="xmlreader_8f90.html#aabb75ff9c02902a838fdd97cd8ac2e63">01105</a> <span class="keyword">subroutine </span><a class="code" href="xmlreader_8f90.html#aabb75ff9c02902a838fdd97cd8ac2e63">close_typedef</a>( component )
<a name="l01106"></a>01106    <span class="keywordtype">logical</span>, <span class="keywordtype">intent(out)</span> :: component
<a name="l01107"></a>01107 
<a name="l01108"></a>01108    component = .false.
<a name="l01109"></a>01109    <span class="keyword">write</span>( ludef, <span class="stringliteral">&#39;(a)&#39;</span> ) <span class="stringliteral">&#39;end type &#39;</span>//trim(typename)
<a name="l01110"></a>01110    <span class="keyword">write</span>( luend, <span class="stringliteral">&#39;(a)&#39;</span> ) &amp;
<a name="l01111"></a>01111   &amp;   <span class="stringliteral">&#39;end subroutine read_xml_type_&#39;</span>//trim(typename)
<a name="l01112"></a>01112    <span class="keyword">write</span>( ludeflt, <span class="stringliteral">&#39;(a)&#39;</span> ) &amp;
<a name="l01113"></a>01113   &amp;   <span class="stringliteral">&#39;end subroutine init_xml_type_&#39;</span>//trim(typename)
<a name="l01114"></a>01114    <span class="keyword">write</span>( luwrite, <span class="stringliteral">&#39;(a)&#39;</span> ) &amp;
<a name="l01115"></a>01115   &amp;   <span class="stringliteral">&#39;   write(info%lun,&#39;</span><span class="stringliteral">&#39;(4a)&#39;</span><span class="stringliteral">&#39;) indentation(1:min(indent,100)), &amp;&#39;</span> ,&amp;
<a name="l01116"></a>01116   &amp;   <span class="stringliteral">&#39;       &#39;</span><span class="stringliteral">&#39;&lt;/&#39;</span><span class="stringliteral">&#39; //trim(tag) // &#39;</span><span class="stringliteral">&#39;&gt;&#39;</span><span class="stringliteral">&#39;&#39;</span>, &amp;
<a name="l01117"></a>01117   &amp;   <span class="stringliteral">&#39;end subroutine write_xml_type_&#39;</span>//trim(typename) ,&amp;
<a name="l01118"></a>01118   &amp;   <span class="stringliteral">&#39; &#39;</span>
<a name="l01119"></a>01119    call <a class="code" href="xmlreader_8f90.html#a997ec57f386db45f4934ad33def2efca">append_files</a>( luprolog )
<a name="l01120"></a>01120    call <a class="code" href="xmlreader_8f90.html#afa5569ea1a3d70f4d3fa00bd102ab729">close_tmp_files</a>
<a name="l01121"></a>01121 
<a name="l01122"></a>01122 <span class="keyword">end subroutine close_typedef</span>
<a name="l01123"></a>01123 
<a name="l01124"></a>01124 <span class="comment">!===============================================================================</span>
<a name="l01125"></a>01125 <span class="comment">! ADD_PLACEHOLDER --</span>
<a name="l01126"></a>01126 <span class="comment">!    Routine to write the starting code fragments for a placeholder tag</span>
<a name="l01127"></a>01127 <span class="comment">! Arguments:</span>
<a name="l01128"></a>01128 <span class="comment">!    dyn_strings     Whether dynamic string lengths are allowed</span>
<a name="l01129"></a>01129 <span class="comment">!===============================================================================</span>
<a name="l01130"></a>01130 
<a name="l01131"></a><a class="code" href="xmlreader_8f90.html#ad4ebeea0fdbbd5ae906ed5b33b1834f0">01131</a> <span class="keyword">subroutine </span><a class="code" href="xmlreader_8f90.html#ad4ebeea0fdbbd5ae906ed5b33b1834f0">add_placeholder</a>( dyn_strings )
<a name="l01132"></a>01132    <span class="keywordtype">logical</span>, <span class="keywordtype">intent(in)</span>                    :: dyn_strings
<a name="l01133"></a>01133 
<a name="l01134"></a>01134    <span class="keywordtype">integer</span>                                :: idx1
<a name="l01135"></a>01135    <span class="keywordtype">integer</span>                                :: idx2
<a name="l01136"></a>01136 
<a name="l01137"></a>01137    <span class="keywordtype">character(len=32)</span>                      :: tag
<a name="l01138"></a>01138    <span class="keywordtype">character(len=20)</span>                      :: optional
<a name="l01139"></a>01139 
<a name="l01140"></a>01140    idx1 = <a class="code" href="namespacexmlparse.html#ac197863b0c6820b348aeb8cc46e08255">xml_find_attrib</a>( attribs, noattribs, <span class="stringliteral">&#39;tag&#39;</span>, tag )
<a name="l01141"></a>01141    <span class="keyword">if</span> ( idx1 &lt;= 0 ) <span class="keyword">then</span>
<a name="l01142"></a>01142       <span class="keyword">write</span>( 20, * ) <span class="stringliteral">&#39;Placeholder definition found which has no tag name&#39;</span>
<a name="l01143"></a>01143       error = .true.
<a name="l01144"></a>01144    <span class="keyword">endif</span>
<a name="l01145"></a>01145 
<a name="l01146"></a>01146    <span class="keywordtype">optional</span> = <span class="stringliteral">&#39;no&#39;</span>
<a name="l01147"></a>01147    idx2 = <a class="code" href="namespacexmlparse.html#ac197863b0c6820b348aeb8cc46e08255">xml_find_attrib</a>( attribs, noattribs, <span class="stringliteral">&#39;optional&#39;</span>, <span class="keywordtype">optional</span> )
<a name="l01148"></a>01148 
<a name="l01149"></a>01149    <span class="keyword">if</span> ( <span class="keywordtype">optional</span> == <span class="stringliteral">&#39;yes&#39;</span> ) <span class="keyword">then</span>
<a name="l01150"></a>01150       <span class="keyword">if</span> ( begin_loop ) <span class="keyword">then</span>
<a name="l01151"></a>01151          call <a class="code" href="xmlreader_8f90.html#aa8c9a11ca28b1ede2a9be94c44eabc37">add_begin_loop</a>( .false., .false. )
<a name="l01152"></a>01152       <span class="keyword">endif</span>
<a name="l01153"></a>01153       <span class="keyword">write</span>( luloop, <span class="stringliteral">&#39;(a)&#39;</span> ) &amp;
<a name="l01154"></a>01154          <span class="stringliteral">&#39;      case(&#39;</span><span class="stringliteral">&#39;&#39;</span>//trim(tag)//<span class="stringliteral">&#39;&#39;</span><span class="stringliteral">&#39;)&#39;</span>,&amp;
<a name="l01155"></a>01155          <span class="stringliteral">&#39;         ! Simply ignore the tag&#39;</span>
<a name="l01156"></a>01156    <span class="keyword">else</span>
<a name="l01157"></a>01157       no_placeholders = no_placeholders + 1
<a name="l01158"></a>01158       placeholder(no_placeholders) = tag
<a name="l01159"></a>01159 
<a name="l01160"></a>01160       <span class="keyword">write</span>( luloop, <span class="stringliteral">&#39;(a)&#39;</span> ) &amp;
<a name="l01161"></a>01161          <span class="stringliteral">&#39;      case(&#39;</span><span class="stringliteral">&#39;&#39;</span>//trim(tag)//<span class="stringliteral">&#39;&#39;</span><span class="stringliteral">&#39;)&#39;</span>,&amp;
<a name="l01162"></a>01162         &amp;<span class="stringliteral">&#39;         call read_xml_place_&#39;</span>//trim(tag)//<span class="stringliteral">&#39;( info, &amp;&#39;</span>, &amp;
<a name="l01163"></a>01163         &amp;<span class="stringliteral">&#39;            tag, attribs, noattribs, data, nodata )&#39;</span>
<a name="l01164"></a>01164       comp = .false.
<a name="l01165"></a>01165 
<a name="l01166"></a>01166       <span class="comment">!</span>
<a name="l01167"></a>01167       <span class="comment">! We need a new set of temporary files</span>
<a name="l01168"></a>01168       <span class="comment">!</span>
<a name="l01169"></a>01169       call <a class="code" href="xmlreader_8f90.html#a0d4c0b96aed4f686ec75542ed9c8c01e">open_tmp_files</a>( luprolog+notmps )
<a name="l01170"></a>01170 
<a name="l01171"></a>01171       <span class="comment">!</span>
<a name="l01172"></a>01172       <span class="comment">! Write the first part of the routine</span>
<a name="l01173"></a>01173       <span class="comment">! NOTE:</span>
<a name="l01174"></a>01174       <span class="comment">! Will require an extra argument when collecting all variables</span>
<a name="l01175"></a>01175       <span class="comment">! in one derived type</span>
<a name="l01176"></a>01176       <span class="comment">!</span>
<a name="l01177"></a>01177       <span class="keyword">write</span>( luprolog, <span class="stringliteral">&#39;(a)&#39;</span> ) &amp;
<a name="l01178"></a>01178   &amp;   <span class="stringliteral">&#39;subroutine read_xml_place_&#39;</span>//trim(tag)//&amp;
<a name="l01179"></a>01179   &amp;         <span class="stringliteral">&#39;( info, starttag, attribs, noattribs, data, nodata )&#39;</span>   ,&amp;
<a name="l01180"></a>01180   &amp;   <span class="stringliteral">&#39;   type(XML_PARSE)                                 :: info&#39;</span>   ,&amp;
<a name="l01181"></a>01181   &amp;   <span class="stringliteral">&#39;   character(len=*), intent(in)                    :: starttag&#39;</span>,&amp;
<a name="l01182"></a>01182   &amp;   <span class="stringliteral">&#39;   character(len=*), dimension(:,:), intent(inout) :: attribs&#39;</span>,&amp;
<a name="l01183"></a>01183   &amp;   <span class="stringliteral">&#39;   integer, intent(inout)                          :: noattribs&#39;</span>,&amp;
<a name="l01184"></a>01184   &amp;   <span class="stringliteral">&#39;   character(len=*), dimension(:), intent(inout)   :: data   &#39;</span>,&amp;
<a name="l01185"></a>01185   &amp;   <span class="stringliteral">&#39;   integer, intent(inout)                          :: nodata &#39;</span>,&amp;
<a name="l01186"></a>01186   &amp;   <span class="stringliteral">&#39;   &#39;</span>                                                          ,&amp;
<a name="l01187"></a>01187   &amp;   <span class="stringliteral">&#39;   logical                                      :: error     &#39;</span>,&amp;
<a name="l01188"></a>01188   &amp;   <span class="stringliteral">&#39;   logical                                      :: endtag    &#39;</span>
<a name="l01189"></a>01189       <span class="keyword">if</span> ( dyn_strings ) <span class="keyword">then</span>
<a name="l01190"></a>01190           <span class="keyword">write</span>( luprolog, <span class="stringliteral">&#39;(a)&#39;</span> ) &amp;
<a name="l01191"></a>01191   &amp;   <span class="stringliteral">&#39;   character(len=len(starttag))                 :: tag       &#39;</span>
<a name="l01192"></a>01192       <span class="keyword">else</span>
<a name="l01193"></a>01193           <span class="keyword">write</span>( luprolog, <span class="stringliteral">&#39;(a)&#39;</span> ) &amp;
<a name="l01194"></a>01194   &amp;   <span class="stringliteral">&#39;   character(len=80)                            :: tag       &#39;</span>
<a name="l01195"></a>01195       <span class="keyword">endif</span>
<a name="l01196"></a>01196 
<a name="l01197"></a>01197       begin_loop = .true.
<a name="l01198"></a>01198 
<a name="l01199"></a>01199       call <a class="code" href="xmlreader_8f90.html#abc8f04613aa2829685f5c907e6443153">add_end_loop</a>
<a name="l01200"></a>01200 
<a name="l01201"></a>01201       <span class="keyword">write</span>(luwrite,<span class="stringliteral">&#39;(a)&#39;</span>) &amp;
<a name="l01202"></a>01202         &amp;<span class="stringliteral">&#39;subroutine write_xml_place_&#39;</span>//trim(tag)//<span class="stringliteral">&#39;( &amp;&#39;</span>        ,&amp;
<a name="l01203"></a>01203         &amp;<span class="stringliteral">&#39;      info, indent )&#39;</span>                                 ,&amp;
<a name="l01204"></a>01204         &amp;<span class="stringliteral">&#39;   type(XML_PARSE)                          :: info&#39;</span>  ,&amp;
<a name="l01205"></a>01205         &amp;<span class="stringliteral">&#39;   integer                                  :: indent&#39;</span>,&amp;
<a name="l01206"></a>01206         &amp;<span class="stringliteral">&#39;   character(len=100)                       :: indentation&#39;</span> ,&amp;
<a name="l01207"></a>01207         &amp;<span class="stringliteral">&#39;   indentation = &#39;</span><span class="stringliteral">&#39; &#39;</span><span class="stringliteral">&#39;&#39;</span>                               ,&amp;
<a name="l01208"></a>01208         &amp;<span class="stringliteral">&#39;   write(info%lun, &#39;</span><span class="stringliteral">&#39;(4a)&#39;</span><span class="stringliteral">&#39; ) indentation(1:min(indent,100)),&amp;&#39;</span>,&amp;
<a name="l01209"></a>01209         &amp;<span class="stringliteral">&#39;       &#39;</span><span class="stringliteral">&#39;&lt;&#39;</span>// trim(tag) // <span class="stringliteral">&#39;&gt;&#39;</span><span class="stringliteral">&#39;&#39;</span>
<a name="l01210"></a>01210       <span class="keyword">write</span>(luwritp,<span class="stringliteral">&#39;(a)&#39;</span>) &amp;
<a name="l01211"></a>01211         &amp;<span class="stringliteral">&#39;   call write_xml_place_&#39;</span>//trim(tag)//<span class="stringliteral">&#39;( info, indent+3 )&#39;</span>
<a name="l01212"></a>01212 
<a name="l01213"></a>01213    <span class="keyword">endif</span>
<a name="l01214"></a>01214 <span class="keyword">end subroutine add_placeholder</span>
<a name="l01215"></a>01215 
<a name="l01216"></a>01216 <span class="comment">!===============================================================================</span>
<a name="l01217"></a>01217 <span class="comment">! CLOSE_PLACEHOLDER --</span>
<a name="l01218"></a>01218 <span class="comment">!    Routine to write the last code fragments for a placeholder</span>
<a name="l01219"></a>01219 <span class="comment">! Arguments:</span>
<a name="l01220"></a>01220 <span class="comment">!    None</span>
<a name="l01221"></a>01221 <span class="comment">!===============================================================================</span>
<a name="l01222"></a>01222 
<a name="l01223"></a><a class="code" href="xmlreader_8f90.html#a281485a4b84d9661d3b0c26446d0b277">01223</a> <span class="keyword">subroutine </span><a class="code" href="xmlreader_8f90.html#a281485a4b84d9661d3b0c26446d0b277">close_placeholder</a>
<a name="l01224"></a>01224 
<a name="l01225"></a>01225    <span class="keyword">write</span>( luend, <span class="stringliteral">&#39;(a)&#39;</span> ) &amp;
<a name="l01226"></a>01226   &amp;   <span class="stringliteral">&#39;end subroutine read_xml_place_&#39;</span>//trim(placeholder(no_placeholders))
<a name="l01227"></a>01227 
<a name="l01228"></a>01228    <span class="keyword">write</span>( luwrite, <span class="stringliteral">&#39;(a)&#39;</span> ) &amp;
<a name="l01229"></a>01229   &amp;   <span class="stringliteral">&#39;   write(info%lun,&#39;</span><span class="stringliteral">&#39;(4a)&#39;</span><span class="stringliteral">&#39;) indentation(1:min(indent,100)), &amp;&#39;</span> ,&amp;
<a name="l01230"></a>01230   &amp;   <span class="stringliteral">&#39;       &#39;</span><span class="stringliteral">&#39;&lt;/&#39;</span> //trim(placeholder(no_placeholders)) // <span class="stringliteral">&#39;&gt;&#39;</span><span class="stringliteral">&#39;&#39;</span> ,&amp;
<a name="l01231"></a>01231   &amp;   <span class="stringliteral">&#39;end subroutine write_xml_place_&#39;</span>//trim(placeholder(no_placeholders)) ,&amp;
<a name="l01232"></a>01232   &amp;   <span class="stringliteral">&#39; &#39;</span>
<a name="l01233"></a>01233 
<a name="l01234"></a>01234    call <a class="code" href="xmlreader_8f90.html#a997ec57f386db45f4934ad33def2efca">append_files</a>( luprolog )
<a name="l01235"></a>01235    call <a class="code" href="xmlreader_8f90.html#afa5569ea1a3d70f4d3fa00bd102ab729">close_tmp_files</a>
<a name="l01236"></a>01236 
<a name="l01237"></a>01237    no_placeholders = no_placeholders - 1
<a name="l01238"></a>01238 
<a name="l01239"></a>01239 <span class="keyword">end subroutine close_placeholder</span>
<a name="l01240"></a>01240 
<a name="l01241"></a>01241 <span class="keyword">end program</span>
</pre></div></div>
</div>
<hr class="footer"/><address class="footer"><small>Generated on Thu Mar 8 2012 23:18:38 for SlowMC by&#160;
<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.7.3 </small></address>
</body>
</html>
